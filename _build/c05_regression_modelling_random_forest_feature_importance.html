---
redirect_from:
  - "c05-regression-modelling-random-forest-feature-importance"
interact_link: content/c05_regression_modelling_random_forest_feature_importance.ipynb
kernel_name: datasc
kernel_path: content
has_widgets: false
title: |-
  C05 Regression Modelling Random Forest Feature Importance
pagenum: 18
prev_page:
  url: /b05_regression_data_visualization_and_eda_with_pandas_profiling.html
next_page:
  url: /d02_regression_modelling_using_pyspark_random_forest_tuning.html
suffix: .ipynb
search: toc span data class forest features feature href modified id item random numnbspnbsp lilispana selection modelling encoded search importance using grid spanfeature raw best parameters yellowbrick refit importances yellowbricks node imports load points div itemlispana spanrandom spanuse li ul max min htable contentsspan tocskip h tocul spanimports spanload spangrid spanul num nbspnbsp important hyperparameters nestimators n trees maxfeatures considered splitting maxdepth levels decision tree minsamplessplit placed before split minsamplesleaf allowed leaf bootstrap method sampling without replacement

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">C05 Regression Modelling Random Forest Feature Importance</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h1>Table of Contents<span class="tocSkip"></span></h1></p>
<div class="toc"><ul class="toc-item"><li><span><a href="#Imports" data-toc-modified-id="Imports-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Imports</a></span></li><li><span><a href="#Load-the-data" data-toc-modified-id="Load-the-data-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Load the data</a></span></li><li><span><a href="#Feature-Selection" data-toc-modified-id="Feature-Selection-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>Feature Selection</a></span></li><li><span><a href="#Random-Forest-Modelling-Raw-features" data-toc-modified-id="Random-Forest-Modelling-Raw-features-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>Random Forest Modelling Raw features</a></span></li><li><span><a href="#Random-Forest-Modelling-All-encoded-features" data-toc-modified-id="Random-Forest-Modelling-All-encoded-features-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>Random Forest Modelling All encoded features</a></span></li><li><span><a href="#Grid-Search-All-encoded" data-toc-modified-id="Grid-Search-All-encoded-6"><span class="toc-item-num">6&nbsp;&nbsp;</span>Grid Search All encoded</a></span></li><li><span><a href="#Use-the-best-parameters-from-grid-search" data-toc-modified-id="Use-the-best-parameters-from-grid-search-7"><span class="toc-item-num">7&nbsp;&nbsp;</span>Use the best parameters from grid search</a></span></li><li><span><a href="#Feature-Importance" data-toc-modified-id="Feature-Importance-8"><span class="toc-item-num">8&nbsp;&nbsp;</span>Feature Importance</a></span><ul class="toc-item"><li><span><a href="#feature-importance-using-yellowbrick" data-toc-modified-id="feature-importance-using-yellowbrick-8.1"><span class="toc-item-num">8.1&nbsp;&nbsp;</span>feature importance using yellowbrick</a></span></li></ul></li><li><span><a href="#Use-features-selection-to-refit-random-forest" data-toc-modified-id="Use-features-selection-to-refit-random-forest-9"><span class="toc-item-num">9&nbsp;&nbsp;</span>Use features selection to refit random forest</a></span></li><li><span><a href="#Feature-Importances-using-yellowbricks" data-toc-modified-id="Feature-Importances-using-yellowbricks-10"><span class="toc-item-num">10&nbsp;&nbsp;</span>Feature Importances using yellowbricks</a></span></li></ul></div>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Imports">Imports<a class="anchor-link" href="#Imports"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="k">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">cross_val_score</span>

<span class="c1"># random state</span>
<span class="n">random_state</span><span class="o">=</span><span class="mi">100</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span> <span class="c1"># we need this in each cell</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_state</span><span class="o">=</span><span class="n">random_state</span>

<span class="c1"># Jupyter notebook settings for pandas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.float_format&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:,.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span> <span class="c1"># numbers sep by comma</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># None for all the rows</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="nx">javascript</span>
<span class="nx">IPython</span><span class="p">.</span><span class="nx">OutputArea</span><span class="p">.</span><span class="nx">auto_scroll_threshold</span> <span class="o">=</span> <span class="mi">9999</span><span class="p">;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">




<div id="3b6564db-1a81-4a79-aaa5-8c3b30f07e17"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#3b6564db-1a81-4a79-aaa5-8c3b30f07e17');
IPython.OutputArea.auto_scroll_threshold = 9999;
</script>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span><span class="mi">8</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">yellowbrick.model_selection</span> <span class="k">import</span> <span class="n">FeatureImportances</span>
<span class="kn">from</span> <span class="nn">yellowbrick.features</span> <span class="k">import</span> <span class="n">Rank1D</span>
<span class="kn">from</span> <span class="nn">yellowbrick.features</span> <span class="k">import</span> <span class="n">Rank2D</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">multiple_linear_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">target</span><span class="p">,</span><span class="n">model</span><span class="p">,</span>
                               <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Multiple Linear Regression Modelling using given model.</span>
<span class="sd">    </span>
<span class="sd">    Depends:</span>
<span class="sd">    Depends on function adjusted r-squared.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    rmse, r2_train, ar2_train, r2_test, ar2_test, cv</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">adjustedR2</span><span class="p">(</span><span class="n">rsquared</span><span class="p">,</span><span class="n">nrows</span><span class="p">,</span><span class="n">kcols</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rsquared</span><span class="o">-</span> <span class="p">(</span><span class="n">kcols</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nrows</span><span class="o">-</span><span class="n">kcols</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rsquared</span><span class="p">)</span>
    
    <span class="c1"># train test split</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># train test values</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">Xtrain</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">ytrain</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">Xtest</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">ytest</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    
    <span class="c1"># fitting</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span><span class="n">ytrain</span><span class="p">)</span>

    <span class="c1"># prediction</span>
    <span class="n">ypreds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span>

    <span class="c1"># metrics</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">ytest</span><span class="p">,</span><span class="n">ypreds</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">r2_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span> <span class="n">ytrain</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">r2_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">ytest</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">cv</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">ar2_train</span> <span class="o">=</span> <span class="n">adjustedR2</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span><span class="n">ytrain</span><span class="p">),</span>
                           <span class="n">Xtrain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ar2_test</span>  <span class="o">=</span> <span class="n">adjustedR2</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span><span class="n">ytest</span><span class="p">),</span>
                           <span class="n">Xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span>
                           <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">rmse</span><span class="p">,</span> <span class="n">r2_train</span><span class="p">,</span> <span class="n">ar2_train</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="n">ar2_test</span><span class="p">,</span> <span class="n">cv</span><span class="p">)</span>


<span class="n">df_eval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Model&#39;</span><span class="p">:</span> <span class="p">[],</span>
                           <span class="s1">&#39;Details&#39;</span><span class="p">:[],</span>
                           <span class="s1">&#39;Root Mean Squared Error (RMSE)&#39;</span><span class="p">:[],</span>
                           <span class="s1">&#39;R-squared (training)&#39;</span><span class="p">:[],</span>
                           <span class="s1">&#39;Adjusted R-squared (training)&#39;</span><span class="p">:[],</span>
                           <span class="s1">&#39;R-squared (test)&#39;</span><span class="p">:[],</span>
                           <span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">:[],</span>
                           <span class="s1">&#39;5-Fold Cross Validation&#39;</span><span class="p">:[]})</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Load-the-data">Load the data<a class="anchor-link" href="#Load-the-data"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/processed/data_cleaned_encoded.csv&#39;</span><span class="p">)</span>

<span class="n">df_raw</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>bedrooms</th>
      <th>bathrooms</th>
      <th>sqft_living</th>
      <th>sqft_lot</th>
      <th>floors</th>
      <th>waterfront</th>
      <th>view</th>
      <th>condition</th>
      <th>grade</th>
      <th>sqft_above</th>
      <th>sqft_basement</th>
      <th>yr_built</th>
      <th>yr_renovated</th>
      <th>zipcode</th>
      <th>lat</th>
      <th>long</th>
      <th>sqft_living15</th>
      <th>sqft_lot15</th>
      <th>yr_sales</th>
      <th>age</th>
      <th>yr_renovated2</th>
      <th>age_after_renovation</th>
      <th>zipcode_top10</th>
      <th>zipcode_houses</th>
      <th>basement_bool</th>
      <th>renovation_bool</th>
      <th>age_cat</th>
      <th>age_after_renovation_cat</th>
      <th>waterfront_0</th>
      <th>waterfront_1</th>
      <th>view_0</th>
      <th>view_1</th>
      <th>view_2</th>
      <th>view_3</th>
      <th>view_4</th>
      <th>condition_1</th>
      <th>condition_2</th>
      <th>condition_3</th>
      <th>condition_4</th>
      <th>condition_5</th>
      <th>grade_1</th>
      <th>grade_10</th>
      <th>grade_11</th>
      <th>grade_12</th>
      <th>grade_13</th>
      <th>grade_3</th>
      <th>grade_4</th>
      <th>grade_5</th>
      <th>grade_6</th>
      <th>grade_7</th>
      <th>grade_8</th>
      <th>grade_9</th>
      <th>zipcode_top10_98004</th>
      <th>zipcode_top10_98006</th>
      <th>zipcode_top10_98033</th>
      <th>zipcode_top10_98039</th>
      <th>zipcode_top10_98040</th>
      <th>zipcode_top10_98102</th>
      <th>zipcode_top10_98105</th>
      <th>zipcode_top10_98155</th>
      <th>zipcode_top10_98177</th>
      <th>zipcode_top10_others</th>
      <th>age_cat_0</th>
      <th>age_cat_1</th>
      <th>age_cat_2</th>
      <th>age_cat_3</th>
      <th>age_cat_4</th>
      <th>age_cat_5</th>
      <th>age_cat_6</th>
      <th>age_cat_7</th>
      <th>age_cat_8</th>
      <th>age_cat_9</th>
      <th>age_after_renovation_cat_0</th>
      <th>age_after_renovation_cat_1</th>
      <th>age_after_renovation_cat_2</th>
      <th>age_after_renovation_cat_3</th>
      <th>age_after_renovation_cat_4</th>
      <th>age_after_renovation_cat_5</th>
      <th>age_after_renovation_cat_6</th>
      <th>age_after_renovation_cat_7</th>
      <th>age_after_renovation_cat_8</th>
      <th>age_after_renovation_cat_9</th>
      <th>log1p_price</th>
      <th>log1p_sqft_living</th>
      <th>log1p_sqft_lot</th>
      <th>log1p_sqft_above</th>
      <th>log1p_sqft_basement</th>
      <th>log1p_sqft_living15</th>
      <th>log1p_sqft_lot15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>221,900.00000</td>
      <td>3</td>
      <td>1.00000</td>
      <td>1180</td>
      <td>5650</td>
      <td>1.00000</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>1180</td>
      <td>0</td>
      <td>1955</td>
      <td>0</td>
      <td>98178</td>
      <td>47.51120</td>
      <td>-122.25700</td>
      <td>1340</td>
      <td>5650</td>
      <td>2014</td>
      <td>59</td>
      <td>1955</td>
      <td>59</td>
      <td>others</td>
      <td>262</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>12.30999</td>
      <td>7.07412</td>
      <td>8.63959</td>
      <td>7.07412</td>
      <td>0.00000</td>
      <td>7.20117</td>
      <td>8.63959</td>
    </tr>
    <tr>
      <th>1</th>
      <td>538,000.00000</td>
      <td>3</td>
      <td>2.25000</td>
      <td>2570</td>
      <td>7242</td>
      <td>2.00000</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>2170</td>
      <td>400</td>
      <td>1951</td>
      <td>1991</td>
      <td>98125</td>
      <td>47.72100</td>
      <td>-122.31900</td>
      <td>1690</td>
      <td>7639</td>
      <td>2014</td>
      <td>63</td>
      <td>1991</td>
      <td>23</td>
      <td>others</td>
      <td>410</td>
      <td>1</td>
      <td>1</td>
      <td>5</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>13.19562</td>
      <td>7.85205</td>
      <td>8.88779</td>
      <td>7.68294</td>
      <td>5.99396</td>
      <td>7.43308</td>
      <td>8.94115</td>
    </tr>
    <tr>
      <th>2</th>
      <td>180,000.00000</td>
      <td>2</td>
      <td>1.00000</td>
      <td>770</td>
      <td>10000</td>
      <td>1.00000</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>6</td>
      <td>770</td>
      <td>0</td>
      <td>1933</td>
      <td>0</td>
      <td>98028</td>
      <td>47.73790</td>
      <td>-122.23300</td>
      <td>2720</td>
      <td>8062</td>
      <td>2015</td>
      <td>82</td>
      <td>1933</td>
      <td>82</td>
      <td>others</td>
      <td>283</td>
      <td>0</td>
      <td>0</td>
      <td>7</td>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>12.10072</td>
      <td>6.64769</td>
      <td>9.21044</td>
      <td>6.64769</td>
      <td>0.00000</td>
      <td>7.90875</td>
      <td>8.99504</td>
    </tr>
    <tr>
      <th>3</th>
      <td>604,000.00000</td>
      <td>4</td>
      <td>3.00000</td>
      <td>1960</td>
      <td>5000</td>
      <td>1.00000</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>7</td>
      <td>1050</td>
      <td>910</td>
      <td>1965</td>
      <td>0</td>
      <td>98136</td>
      <td>47.52080</td>
      <td>-122.39300</td>
      <td>1360</td>
      <td>5000</td>
      <td>2014</td>
      <td>49</td>
      <td>1965</td>
      <td>49</td>
      <td>others</td>
      <td>263</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>13.31133</td>
      <td>7.58121</td>
      <td>8.51739</td>
      <td>6.95750</td>
      <td>6.81454</td>
      <td>7.21598</td>
      <td>8.51739</td>
    </tr>
    <tr>
      <th>4</th>
      <td>510,000.00000</td>
      <td>3</td>
      <td>2.00000</td>
      <td>1680</td>
      <td>8080</td>
      <td>1.00000</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>8</td>
      <td>1680</td>
      <td>0</td>
      <td>1987</td>
      <td>0</td>
      <td>98074</td>
      <td>47.61680</td>
      <td>-122.04500</td>
      <td>1800</td>
      <td>7503</td>
      <td>2015</td>
      <td>28</td>
      <td>1987</td>
      <td>28</td>
      <td>others</td>
      <td>441</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>13.14217</td>
      <td>7.42714</td>
      <td>8.99727</td>
      <td>7.42714</td>
      <td>0.00000</td>
      <td>7.49610</td>
      <td>8.92319</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Feature-Selection">Feature Selection<a class="anchor-link" href="#Feature-Selection"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([&#39;price&#39;, &#39;bedrooms&#39;, &#39;bathrooms&#39;, &#39;sqft_living&#39;, &#39;sqft_lot&#39;,
       &#39;floors&#39;, &#39;waterfront&#39;, &#39;view&#39;, &#39;condition&#39;, &#39;grade&#39;, &#39;sqft_above&#39;,
       &#39;sqft_basement&#39;, &#39;yr_built&#39;, &#39;yr_renovated&#39;, &#39;zipcode&#39;, &#39;lat&#39;,
       &#39;long&#39;, &#39;sqft_living15&#39;, &#39;sqft_lot15&#39;, &#39;yr_sales&#39;, &#39;age&#39;,
       &#39;yr_renovated2&#39;, &#39;age_after_renovation&#39;, &#39;zipcode_top10&#39;,
       &#39;zipcode_houses&#39;, &#39;basement_bool&#39;, &#39;renovation_bool&#39;, &#39;age_cat&#39;,
       &#39;age_after_renovation_cat&#39;, &#39;waterfront_0&#39;, &#39;waterfront_1&#39;,
       &#39;view_0&#39;, &#39;view_1&#39;, &#39;view_2&#39;, &#39;view_3&#39;, &#39;view_4&#39;, &#39;condition_1&#39;,
       &#39;condition_2&#39;, &#39;condition_3&#39;, &#39;condition_4&#39;, &#39;condition_5&#39;,
       &#39;grade_1&#39;, &#39;grade_10&#39;, &#39;grade_11&#39;, &#39;grade_12&#39;, &#39;grade_13&#39;,
       &#39;grade_3&#39;, &#39;grade_4&#39;, &#39;grade_5&#39;, &#39;grade_6&#39;, &#39;grade_7&#39;, &#39;grade_8&#39;,
       &#39;grade_9&#39;, &#39;zipcode_top10_98004&#39;, &#39;zipcode_top10_98006&#39;,
       &#39;zipcode_top10_98033&#39;, &#39;zipcode_top10_98039&#39;,
       &#39;zipcode_top10_98040&#39;, &#39;zipcode_top10_98102&#39;,
       &#39;zipcode_top10_98105&#39;, &#39;zipcode_top10_98155&#39;,
       &#39;zipcode_top10_98177&#39;, &#39;zipcode_top10_others&#39;, &#39;age_cat_0&#39;,
       &#39;age_cat_1&#39;, &#39;age_cat_2&#39;, &#39;age_cat_3&#39;, &#39;age_cat_4&#39;, &#39;age_cat_5&#39;,
       &#39;age_cat_6&#39;, &#39;age_cat_7&#39;, &#39;age_cat_8&#39;, &#39;age_cat_9&#39;,
       &#39;age_after_renovation_cat_0&#39;, &#39;age_after_renovation_cat_1&#39;,
       &#39;age_after_renovation_cat_2&#39;, &#39;age_after_renovation_cat_3&#39;,
       &#39;age_after_renovation_cat_4&#39;, &#39;age_after_renovation_cat_5&#39;,
       &#39;age_after_renovation_cat_6&#39;, &#39;age_after_renovation_cat_7&#39;,
       &#39;age_after_renovation_cat_8&#39;, &#39;age_after_renovation_cat_9&#39;,
       &#39;log1p_price&#39;, &#39;log1p_sqft_living&#39;, &#39;log1p_sqft_lot&#39;,
       &#39;log1p_sqft_above&#39;, &#39;log1p_sqft_basement&#39;, &#39;log1p_sqft_living15&#39;,
       &#39;log1p_sqft_lot15&#39;], dtype=object)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;_\d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;waterfront_0&#39;, &#39;waterfront_1&#39;, &#39;view_0&#39;, &#39;view_1&#39;, &#39;view_2&#39;, &#39;view_3&#39;,
       &#39;view_4&#39;, &#39;condition_1&#39;, &#39;condition_2&#39;, &#39;condition_3&#39;, &#39;condition_4&#39;,
       &#39;condition_5&#39;, &#39;grade_1&#39;, &#39;grade_10&#39;, &#39;grade_11&#39;, &#39;grade_12&#39;,
       &#39;grade_13&#39;, &#39;grade_3&#39;, &#39;grade_4&#39;, &#39;grade_5&#39;, &#39;grade_6&#39;, &#39;grade_7&#39;,
       &#39;grade_8&#39;, &#39;grade_9&#39;, &#39;zipcode_top10_98004&#39;, &#39;zipcode_top10_98006&#39;,
       &#39;zipcode_top10_98033&#39;, &#39;zipcode_top10_98039&#39;, &#39;zipcode_top10_98040&#39;,
       &#39;zipcode_top10_98102&#39;, &#39;zipcode_top10_98105&#39;, &#39;zipcode_top10_98155&#39;,
       &#39;zipcode_top10_98177&#39;, &#39;age_cat_0&#39;, &#39;age_cat_1&#39;, &#39;age_cat_2&#39;,
       &#39;age_cat_3&#39;, &#39;age_cat_4&#39;, &#39;age_cat_5&#39;, &#39;age_cat_6&#39;, &#39;age_cat_7&#39;,
       &#39;age_cat_8&#39;, &#39;age_cat_9&#39;, &#39;age_after_renovation_cat_0&#39;,
       &#39;age_after_renovation_cat_1&#39;, &#39;age_after_renovation_cat_2&#39;,
       &#39;age_after_renovation_cat_3&#39;, &#39;age_after_renovation_cat_4&#39;,
       &#39;age_after_renovation_cat_5&#39;, &#39;age_after_renovation_cat_6&#39;,
       &#39;age_after_renovation_cat_7&#39;, &#39;age_after_renovation_cat_8&#39;,
       &#39;age_after_renovation_cat_9&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_orig</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/raw/kc_house_data.csv&#39;</span><span class="p">,</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_orig</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;id&#39;, &#39;date&#39;, &#39;price&#39;, &#39;bedrooms&#39;, &#39;bathrooms&#39;, &#39;sqft_living&#39;,
       &#39;sqft_lot&#39;, &#39;floors&#39;, &#39;waterfront&#39;, &#39;view&#39;, &#39;condition&#39;, &#39;grade&#39;,
       &#39;sqft_above&#39;, &#39;sqft_basement&#39;, &#39;yr_built&#39;, &#39;yr_renovated&#39;, &#39;zipcode&#39;,
       &#39;lat&#39;, &#39;long&#39;, &#39;sqft_living15&#39;, &#39;sqft_lot15&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">features_orig</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_living&#39;</span><span class="p">,</span>
       <span class="s1">&#39;sqft_lot&#39;</span><span class="p">,</span> <span class="s1">&#39;floors&#39;</span><span class="p">,</span> <span class="s1">&#39;waterfront&#39;</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="s1">&#39;grade&#39;</span><span class="p">,</span>
       <span class="s1">&#39;sqft_above&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_basement&#39;</span><span class="p">,</span> <span class="s1">&#39;yr_built&#39;</span><span class="p">,</span> <span class="s1">&#39;yr_renovated&#39;</span><span class="p">,</span> <span class="s1">&#39;zipcode&#39;</span><span class="p">,</span>
       <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;long&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_living15&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_lot15&#39;</span><span class="p">]</span>

<span class="n">cols_num</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;bathrooms&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sqft_living&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_lot&#39;</span><span class="p">,</span><span class="s1">&#39;sqft_above&#39;</span><span class="p">,</span><span class="s1">&#39;sqft_basement&#39;</span><span class="p">,</span>
            <span class="s1">&#39;yr_built&#39;</span><span class="p">,</span> <span class="s1">&#39;yr_renovated&#39;</span><span class="p">,</span>
           <span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;long&#39;</span><span class="p">,</span>
           <span class="s1">&#39;sqft_living15&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_lot15&#39;</span><span class="p">,</span> <span class="s1">&#39;yr_sales&#39;</span><span class="p">]</span>

<span class="n">cols_bool</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;basement_bool&#39;</span><span class="p">,</span> <span class="s1">&#39;renovation_bool&#39;</span><span class="p">]</span>

<span class="n">cols_new</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;zipcode_houses&#39;</span><span class="p">]</span>

<span class="n">cols_cat</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># waterfront</span>
    <span class="s1">&#39;waterfront_0&#39;</span><span class="p">,</span> <span class="s1">&#39;waterfront_1&#39;</span><span class="p">,</span>
    
    <span class="c1">#view</span>
    <span class="s1">&#39;view_0&#39;</span><span class="p">,</span> <span class="s1">&#39;view_1&#39;</span><span class="p">,</span> <span class="s1">&#39;view_2&#39;</span><span class="p">,</span> <span class="s1">&#39;view_3&#39;</span><span class="p">,</span><span class="s1">&#39;view_4&#39;</span><span class="p">,</span>
    
    <span class="c1"># condition</span>
    <span class="s1">&#39;condition_1&#39;</span><span class="p">,</span> <span class="s1">&#39;condition_2&#39;</span><span class="p">,</span> <span class="s1">&#39;condition_3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;condition_4&#39;</span><span class="p">,</span><span class="s1">&#39;condition_5&#39;</span><span class="p">,</span>
    
    <span class="c1"># grade</span>
    <span class="s1">&#39;grade_1&#39;</span><span class="p">,</span> <span class="s1">&#39;grade_10&#39;</span><span class="p">,</span> <span class="s1">&#39;grade_11&#39;</span><span class="p">,</span> <span class="s1">&#39;grade_12&#39;</span><span class="p">,</span><span class="s1">&#39;grade_13&#39;</span><span class="p">,</span>
    <span class="s1">&#39;grade_3&#39;</span><span class="p">,</span> <span class="s1">&#39;grade_4&#39;</span><span class="p">,</span> <span class="s1">&#39;grade_5&#39;</span><span class="p">,</span> <span class="s1">&#39;grade_6&#39;</span><span class="p">,</span> <span class="s1">&#39;grade_7&#39;</span><span class="p">,</span><span class="s1">&#39;grade_8&#39;</span><span class="p">,</span> <span class="s1">&#39;grade_9&#39;</span><span class="p">,</span>
            
    <span class="c1"># zipcode</span>
    <span class="s1">&#39;zipcode_top10_98004&#39;</span><span class="p">,</span> <span class="s1">&#39;zipcode_top10_98006&#39;</span><span class="p">,</span>
    <span class="s1">&#39;zipcode_top10_98033&#39;</span><span class="p">,</span> <span class="s1">&#39;zipcode_top10_98039&#39;</span><span class="p">,</span>
    <span class="s1">&#39;zipcode_top10_98040&#39;</span><span class="p">,</span><span class="s1">&#39;zipcode_top10_98102&#39;</span><span class="p">,</span>
    <span class="s1">&#39;zipcode_top10_98105&#39;</span><span class="p">,</span> <span class="s1">&#39;zipcode_top10_98155&#39;</span><span class="p">,</span>
    <span class="s1">&#39;zipcode_top10_98177&#39;</span><span class="p">]</span>



<span class="n">cols_cat_age</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;age_cat_0&#39;</span><span class="p">,</span> <span class="s1">&#39;age_cat_1&#39;</span><span class="p">,</span> <span class="s1">&#39;age_cat_2&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;age_cat_3&#39;</span><span class="p">,</span> <span class="s1">&#39;age_cat_4&#39;</span><span class="p">,</span> <span class="s1">&#39;age_cat_5&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;age_cat_6&#39;</span><span class="p">,</span> <span class="s1">&#39;age_cat_7&#39;</span><span class="p">,</span> <span class="s1">&#39;age_cat_8&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;age_cat_9&#39;</span><span class="p">]</span>

<span class="n">cols_cat_agernv</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;age_after_renovation_cat_0&#39;</span><span class="p">,</span><span class="s1">&#39;age_after_renovation_cat_1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;age_after_renovation_cat_2&#39;</span><span class="p">,</span> <span class="s1">&#39;age_after_renovation_cat_3&#39;</span><span class="p">,</span>
                <span class="s1">&#39;age_after_renovation_cat_4&#39;</span><span class="p">,</span> <span class="s1">&#39;age_after_renovation_cat_5&#39;</span><span class="p">,</span>
                <span class="s1">&#39;age_after_renovation_cat_6&#39;</span><span class="p">,</span> <span class="s1">&#39;age_after_renovation_cat_7&#39;</span><span class="p">,</span>
                <span class="s1">&#39;age_after_renovation_cat_8&#39;</span><span class="p">,</span> <span class="s1">&#39;age_after_renovation_cat_9&#39;</span><span class="p">]</span>

<span class="n">features_all_encoded</span> <span class="o">=</span> <span class="n">cols_num</span> <span class="o">+</span> <span class="n">cols_bool</span> <span class="o">+</span> <span class="n">cols_new</span> <span class="o">+</span> <span class="n">cols_cat</span> <span class="o">+</span> <span class="n">cols_cat_age</span> <span class="o">+</span> <span class="n">cols_cat_agernv</span>
<span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Random-Forest-Modelling-Raw-features">Random Forest Modelling Raw features<a class="anchor-link" href="#Random-Forest-Modelling-Raw-features"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">features_orig</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="n">features</span> <span class="o">+</span> <span class="n">target</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

<span class="n">rmse</span><span class="p">,</span> <span class="n">r2_train</span><span class="p">,</span> <span class="n">ar2_train</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="n">ar2_test</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> \
    <span class="n">multiple_linear_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">model</span><span class="p">,</span>
                               <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>


<span class="n">df_eval</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_eval</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Random Forest Regressor&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;all orig features&#39;</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span><span class="n">r2_train</span><span class="p">,</span><span class="n">ar2_train</span><span class="p">,</span>
                             <span class="n">r2_test</span><span class="p">,</span><span class="n">ar2_test</span><span class="p">,</span><span class="n">cv</span><span class="p">]</span>


<span class="n">df_eval</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/poudel/miniconda3/envs/dataSc/lib/python3.7/site-packages/sklearn/ensemble/forest.py:245: FutureWarning: The default value of n_estimators will change from 10 in version 0.20 to 100 in 0.22.
  &#34;10 in version 0.20 to 100 in 0.22.&#34;, FutureWarning)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style  type="text/css" >
    #T_526aee6a_ebbd_11e9_a4bc_acde48001122row0_col6 {
            background-color:  #fff7fb;
            color:  #000000;
        }</style><table id="T_526aee6a_ebbd_11e9_a4bc_acde48001122" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >Model</th>        <th class="col_heading level0 col1" >Details</th>        <th class="col_heading level0 col2" >Root Mean Squared Error (RMSE)</th>        <th class="col_heading level0 col3" >R-squared (training)</th>        <th class="col_heading level0 col4" >Adjusted R-squared (training)</th>        <th class="col_heading level0 col5" >R-squared (test)</th>        <th class="col_heading level0 col6" >Adjusted R-squared (test)</th>        <th class="col_heading level0 col7" >5-Fold Cross Validation</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_526aee6a_ebbd_11e9_a4bc_acde48001122level0_row0" class="row_heading level0 row0" >0</th>
                        <td id="T_526aee6a_ebbd_11e9_a4bc_acde48001122row0_col0" class="data row0 col0" >Random Forest Regressor</td>
                        <td id="T_526aee6a_ebbd_11e9_a4bc_acde48001122row0_col1" class="data row0 col1" >all orig features</td>
                        <td id="T_526aee6a_ebbd_11e9_a4bc_acde48001122row0_col2" class="data row0 col2" >130835</td>
                        <td id="T_526aee6a_ebbd_11e9_a4bc_acde48001122row0_col3" class="data row0 col3" >0.974</td>
                        <td id="T_526aee6a_ebbd_11e9_a4bc_acde48001122row0_col4" class="data row0 col4" >0.974</td>
                        <td id="T_526aee6a_ebbd_11e9_a4bc_acde48001122row0_col5" class="data row0 col5" >0.873</td>
                        <td id="T_526aee6a_ebbd_11e9_a4bc_acde48001122row0_col6" class="data row0 col6" >0.872</td>
                        <td id="T_526aee6a_ebbd_11e9_a4bc_acde48001122row0_col7" class="data row0 col7" >0.86</td>
            </tr>
    </tbody></table>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>

<span class="n">features</span> <span class="o">=</span> <span class="n">features_orig</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">50</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

<span class="n">rmse</span><span class="p">,</span> <span class="n">r2_train</span><span class="p">,</span> <span class="n">ar2_train</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="n">ar2_test</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> \
    <span class="n">multiple_linear_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">model</span><span class="p">,</span>
                               <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>


<span class="n">df_eval</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_eval</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Random Forest Regressor&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;all orig features n_estimators=50&#39;</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span><span class="n">r2_train</span><span class="p">,</span><span class="n">ar2_train</span><span class="p">,</span>
                             <span class="n">r2_test</span><span class="p">,</span><span class="n">ar2_test</span><span class="p">,</span><span class="n">cv</span><span class="p">]</span>


<span class="n">df_eval</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style  type="text/css" >
    #T_5dc78638_ebbd_11e9_a4bc_acde48001122row0_col6 {
            background-color:  #023858;
            color:  #f1f1f1;
        }    #T_5dc78638_ebbd_11e9_a4bc_acde48001122row1_col6 {
            background-color:  #fff7fb;
            color:  #000000;
        }</style><table id="T_5dc78638_ebbd_11e9_a4bc_acde48001122" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >Model</th>        <th class="col_heading level0 col1" >Details</th>        <th class="col_heading level0 col2" >Root Mean Squared Error (RMSE)</th>        <th class="col_heading level0 col3" >R-squared (training)</th>        <th class="col_heading level0 col4" >Adjusted R-squared (training)</th>        <th class="col_heading level0 col5" >R-squared (test)</th>        <th class="col_heading level0 col6" >Adjusted R-squared (test)</th>        <th class="col_heading level0 col7" >5-Fold Cross Validation</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_5dc78638_ebbd_11e9_a4bc_acde48001122level0_row0" class="row_heading level0 row0" >1</th>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row0_col0" class="data row0 col0" >Random Forest Regressor</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row0_col1" class="data row0 col1" >all orig features n_estimators=50</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row0_col2" class="data row0 col2" >125317</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row0_col3" class="data row0 col3" >0.981</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row0_col4" class="data row0 col4" >0.981</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row0_col5" class="data row0 col5" >0.883</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row0_col6" class="data row0 col6" >0.883</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row0_col7" class="data row0 col7" >0.872</td>
            </tr>
            <tr>
                        <th id="T_5dc78638_ebbd_11e9_a4bc_acde48001122level0_row1" class="row_heading level0 row1" >0</th>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row1_col0" class="data row1 col0" >Random Forest Regressor</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row1_col1" class="data row1 col1" >all orig features</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row1_col2" class="data row1 col2" >130835</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row1_col3" class="data row1 col3" >0.974</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row1_col4" class="data row1 col4" >0.974</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row1_col5" class="data row1 col5" >0.873</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row1_col6" class="data row1 col6" >0.872</td>
                        <td id="T_5dc78638_ebbd_11e9_a4bc_acde48001122row1_col7" class="data row1 col7" >0.86</td>
            </tr>
    </tbody></table>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Random-Forest-Modelling-All-encoded-features">Random Forest Modelling All encoded features<a class="anchor-link" href="#Random-Forest-Modelling-All-encoded-features"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">features_all_encoded</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="n">features</span> <span class="o">+</span> <span class="n">target</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

<span class="n">rmse</span><span class="p">,</span> <span class="n">r2_train</span><span class="p">,</span> <span class="n">ar2_train</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="n">ar2_test</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> \
    <span class="n">multiple_linear_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">model</span><span class="p">,</span>
                               <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>


<span class="n">df_eval</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_eval</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Random Forest Regressor&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;all encoded features&#39;</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span><span class="n">r2_train</span><span class="p">,</span><span class="n">ar2_train</span><span class="p">,</span>
                             <span class="n">r2_test</span><span class="p">,</span><span class="n">ar2_test</span><span class="p">,</span><span class="n">cv</span><span class="p">]</span>


<span class="n">df_eval</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/poudel/miniconda3/envs/dataSc/lib/python3.7/site-packages/sklearn/ensemble/forest.py:245: FutureWarning: The default value of n_estimators will change from 10 in version 0.20 to 100 in 0.22.
  &#34;10 in version 0.20 to 100 in 0.22.&#34;, FutureWarning)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style  type="text/css" >
    #T_613d67f6_ebbd_11e9_a4bc_acde48001122row0_col6 {
            background-color:  #023858;
            color:  #f1f1f1;
        }    #T_613d67f6_ebbd_11e9_a4bc_acde48001122row1_col6 {
            background-color:  #cacee5;
            color:  #000000;
        }    #T_613d67f6_ebbd_11e9_a4bc_acde48001122row2_col6 {
            background-color:  #fff7fb;
            color:  #000000;
        }</style><table id="T_613d67f6_ebbd_11e9_a4bc_acde48001122" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >Model</th>        <th class="col_heading level0 col1" >Details</th>        <th class="col_heading level0 col2" >Root Mean Squared Error (RMSE)</th>        <th class="col_heading level0 col3" >R-squared (training)</th>        <th class="col_heading level0 col4" >Adjusted R-squared (training)</th>        <th class="col_heading level0 col5" >R-squared (test)</th>        <th class="col_heading level0 col6" >Adjusted R-squared (test)</th>        <th class="col_heading level0 col7" >5-Fold Cross Validation</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_613d67f6_ebbd_11e9_a4bc_acde48001122level0_row0" class="row_heading level0 row0" >1</th>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row0_col0" class="data row0 col0" >Random Forest Regressor</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row0_col1" class="data row0 col1" >all orig features n_estimators=50</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row0_col2" class="data row0 col2" >125317</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row0_col3" class="data row0 col3" >0.981</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row0_col4" class="data row0 col4" >0.981</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row0_col5" class="data row0 col5" >0.883</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row0_col6" class="data row0 col6" >0.883</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row0_col7" class="data row0 col7" >0.872</td>
            </tr>
            <tr>
                        <th id="T_613d67f6_ebbd_11e9_a4bc_acde48001122level0_row1" class="row_heading level0 row1" >0</th>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row1_col0" class="data row1 col0" >Random Forest Regressor</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row1_col1" class="data row1 col1" >all orig features</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row1_col2" class="data row1 col2" >130835</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row1_col3" class="data row1 col3" >0.974</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row1_col4" class="data row1 col4" >0.974</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row1_col5" class="data row1 col5" >0.873</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row1_col6" class="data row1 col6" >0.872</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row1_col7" class="data row1 col7" >0.86</td>
            </tr>
            <tr>
                        <th id="T_613d67f6_ebbd_11e9_a4bc_acde48001122level0_row2" class="row_heading level0 row2" >2</th>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row2_col0" class="data row2 col0" >Random Forest Regressor</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row2_col1" class="data row2 col1" >all encoded features</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row2_col2" class="data row2 col2" >132481</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row2_col3" class="data row2 col3" >0.975</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row2_col4" class="data row2 col4" >0.975</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row2_col5" class="data row2 col5" >0.87</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row2_col6" class="data row2 col6" >0.868</td>
                        <td id="T_613d67f6_ebbd_11e9_a4bc_acde48001122row2_col7" class="data row2 col7" >0.86</td>
            </tr>
    </tbody></table>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">features_all_encoded</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="n">features</span> <span class="o">+</span> <span class="n">target</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">50</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

<span class="n">rmse</span><span class="p">,</span> <span class="n">r2_train</span><span class="p">,</span> <span class="n">ar2_train</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="n">ar2_test</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> \
    <span class="n">multiple_linear_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">model</span><span class="p">,</span>
                               <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>


<span class="n">df_eval</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_eval</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Random Forest Regressor&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;all encoded features, n_estimators=50&#39;</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span><span class="n">r2_train</span><span class="p">,</span><span class="n">ar2_train</span><span class="p">,</span>
                             <span class="n">r2_test</span><span class="p">,</span><span class="n">ar2_test</span><span class="p">,</span><span class="n">cv</span><span class="p">]</span>


<span class="n">df_eval</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style  type="text/css" >
    #T_727fdd6e_ebbd_11e9_a4bc_acde48001122row0_col6 {
            background-color:  #023858;
            color:  #f1f1f1;
        }    #T_727fdd6e_ebbd_11e9_a4bc_acde48001122row1_col6 {
            background-color:  #1379b5;
            color:  #f1f1f1;
        }    #T_727fdd6e_ebbd_11e9_a4bc_acde48001122row2_col6 {
            background-color:  #dedcec;
            color:  #000000;
        }    #T_727fdd6e_ebbd_11e9_a4bc_acde48001122row3_col6 {
            background-color:  #fff7fb;
            color:  #000000;
        }</style><table id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >Model</th>        <th class="col_heading level0 col1" >Details</th>        <th class="col_heading level0 col2" >Root Mean Squared Error (RMSE)</th>        <th class="col_heading level0 col3" >R-squared (training)</th>        <th class="col_heading level0 col4" >Adjusted R-squared (training)</th>        <th class="col_heading level0 col5" >R-squared (test)</th>        <th class="col_heading level0 col6" >Adjusted R-squared (test)</th>        <th class="col_heading level0 col7" >5-Fold Cross Validation</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122level0_row0" class="row_heading level0 row0" >3</th>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row0_col0" class="data row0 col0" >Random Forest Regressor</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row0_col1" class="data row0 col1" >all encoded features, n_estimators=50</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row0_col2" class="data row0 col2" >121276</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row0_col3" class="data row0 col3" >0.982</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row0_col4" class="data row0 col4" >0.982</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row0_col5" class="data row0 col5" >0.891</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row0_col6" class="data row0 col6" >0.889</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row0_col7" class="data row0 col7" >0.87</td>
            </tr>
            <tr>
                        <th id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122level0_row1" class="row_heading level0 row1" >1</th>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row1_col0" class="data row1 col0" >Random Forest Regressor</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row1_col1" class="data row1 col1" >all orig features n_estimators=50</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row1_col2" class="data row1 col2" >125317</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row1_col3" class="data row1 col3" >0.981</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row1_col4" class="data row1 col4" >0.981</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row1_col5" class="data row1 col5" >0.883</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row1_col6" class="data row1 col6" >0.883</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row1_col7" class="data row1 col7" >0.872</td>
            </tr>
            <tr>
                        <th id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122level0_row2" class="row_heading level0 row2" >0</th>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row2_col0" class="data row2 col0" >Random Forest Regressor</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row2_col1" class="data row2 col1" >all orig features</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row2_col2" class="data row2 col2" >130835</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row2_col3" class="data row2 col3" >0.974</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row2_col4" class="data row2 col4" >0.974</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row2_col5" class="data row2 col5" >0.873</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row2_col6" class="data row2 col6" >0.872</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row2_col7" class="data row2 col7" >0.86</td>
            </tr>
            <tr>
                        <th id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122level0_row3" class="row_heading level0 row3" >2</th>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row3_col0" class="data row3 col0" >Random Forest Regressor</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row3_col1" class="data row3 col1" >all encoded features</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row3_col2" class="data row3 col2" >132481</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row3_col3" class="data row3 col3" >0.975</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row3_col4" class="data row3 col4" >0.975</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row3_col5" class="data row3 col5" >0.87</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row3_col6" class="data row3 col6" >0.868</td>
                        <td id="T_727fdd6e_ebbd_11e9_a4bc_acde48001122row3_col7" class="data row3 col7" >0.86</td>
            </tr>
    </tbody></table>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Grid-Search-All-encoded">Grid Search All encoded<a class="anchor-link" href="#Grid-Search-All-encoded"> </a></h1><p>Most important hyperparameters of Random Forest:</p>
<ul>
<li>n_estimators = n of trees</li>
<li>max_features = max number of features considered for splitting a node</li>
<li>max_depth = max number of levels in each decision tree</li>
<li>min_samples_split = min number of data points placed in a node before the node is split</li>
<li>min_samples_leaf = min number of data points allowed in a leaf node</li>
<li>bootstrap = method for sampling data points (with or without replacement)</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">features_all_encoded</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="n">features</span> <span class="o">+</span> <span class="n">target</span><span class="p">]</span>

<span class="c1"># train test split</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

<span class="c1"># train test values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">Xtrain</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ytrain</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">Xtest</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ytest</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">GridSearchCV</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>


<span class="n">param_grid</span> <span class="o">=</span> <span class="p">[</span>
<span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
 <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)],</span> 
 <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
 <span class="s1">&#39;bootstrap&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]}</span>
<span class="p">]</span>

<span class="n">grid_search_forest</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                                  <span class="n">param_grid</span><span class="p">,</span>
                                  <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                  <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span>
                                  <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">grid_search_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span> <span class="n">ytrain</span><span class="p">)</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time taken: </span><span class="si">{:.0f}</span><span class="s1"> min </span><span class="si">{:.0f}</span><span class="s1"> secs&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">divmod</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="mi">60</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Fitting 5 folds for each of 24 candidates, totalling 120 fits
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 4 concurrent workers.
[Parallel(n_jobs=-1)]: Done  33 tasks      | elapsed:   15.0s
[Parallel(n_jobs=-1)]: Done 120 out of 120 | elapsed:  1.9min finished
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Time taken: 1 min 58 secs
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Use-the-best-parameters-from-grid-search">Use the best parameters from grid search<a class="anchor-link" href="#Use-the-best-parameters-from-grid-search"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grid_search_forest</span><span class="o">.</span><span class="n">best_estimator_</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>RandomForestRegressor(bootstrap=True, criterion=&#39;mse&#39;, max_depth=50,
                      max_features=69, max_leaf_nodes=None,
                      min_impurity_decrease=0.0, min_impurity_split=None,
                      min_samples_leaf=1, min_samples_split=2,
                      min_weight_fraction_leaf=0.0, n_estimators=40,
                      n_jobs=None, oob_score=False, random_state=100, verbose=0,
                      warm_start=False)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grid_search_forest</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;bootstrap&#39;: True, &#39;max_depth&#39;: 50, &#39;max_features&#39;: 69, &#39;n_estimators&#39;: 40}</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">features_all_encoded</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="n">features</span> <span class="o">+</span> <span class="n">target</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">40</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                              <span class="n">max_features</span><span class="o">=</span><span class="mi">69</span><span class="p">,</span>
                              <span class="n">max_depth</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">rmse</span><span class="p">,</span> <span class="n">r2_train</span><span class="p">,</span> <span class="n">ar2_train</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="n">ar2_test</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> \
    <span class="n">multiple_linear_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">model</span><span class="p">,</span>
                               <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>


<span class="n">df_eval</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_eval</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Random Forest Regressor after grid search&#39;</span><span class="p">,</span>
                             <span class="s1">&#39; all encoded features, best grid search,</span><span class="se">\</span>
<span class="s1">                             n_estimators=40, max_features=69, max_depth=50&#39;</span><span class="p">,</span>
                             <span class="n">rmse</span><span class="p">,</span><span class="n">r2_train</span><span class="p">,</span><span class="n">ar2_train</span><span class="p">,</span>
                             <span class="n">r2_test</span><span class="p">,</span><span class="n">ar2_test</span><span class="p">,</span><span class="n">cv</span><span class="p">]</span>


<span class="n">df_eval</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 4 concurrent workers.
[Parallel(n_jobs=-1)]: Done   5 out of   5 | elapsed:   16.2s finished
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style  type="text/css" >
    #T_c6678f58_ebbd_11e9_a4bc_acde48001122row0_col6 {
            background-color:  #023858;
            color:  #f1f1f1;
        }    #T_c6678f58_ebbd_11e9_a4bc_acde48001122row1_col6 {
            background-color:  #03456c;
            color:  #f1f1f1;
        }    #T_c6678f58_ebbd_11e9_a4bc_acde48001122row2_col6 {
            background-color:  #1379b5;
            color:  #f1f1f1;
        }    #T_c6678f58_ebbd_11e9_a4bc_acde48001122row3_col6 {
            background-color:  #dedcec;
            color:  #000000;
        }    #T_c6678f58_ebbd_11e9_a4bc_acde48001122row4_col6 {
            background-color:  #fff7fb;
            color:  #000000;
        }</style><table id="T_c6678f58_ebbd_11e9_a4bc_acde48001122" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >Model</th>        <th class="col_heading level0 col1" >Details</th>        <th class="col_heading level0 col2" >Root Mean Squared Error (RMSE)</th>        <th class="col_heading level0 col3" >R-squared (training)</th>        <th class="col_heading level0 col4" >Adjusted R-squared (training)</th>        <th class="col_heading level0 col5" >R-squared (test)</th>        <th class="col_heading level0 col6" >Adjusted R-squared (test)</th>        <th class="col_heading level0 col7" >5-Fold Cross Validation</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_c6678f58_ebbd_11e9_a4bc_acde48001122level0_row0" class="row_heading level0 row0" >3</th>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row0_col0" class="data row0 col0" >Random Forest Regressor</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row0_col1" class="data row0 col1" >all encoded features, n_estimators=50</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row0_col2" class="data row0 col2" >121276</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row0_col3" class="data row0 col3" >0.982</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row0_col4" class="data row0 col4" >0.982</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row0_col5" class="data row0 col5" >0.891</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row0_col6" class="data row0 col6" >0.889</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row0_col7" class="data row0 col7" >0.87</td>
            </tr>
            <tr>
                        <th id="T_c6678f58_ebbd_11e9_a4bc_acde48001122level0_row1" class="row_heading level0 row1" >4</th>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row1_col0" class="data row1 col0" >Random Forest Regressor after grid search</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row1_col1" class="data row1 col1" > all encoded features, best grid search,                             n_estimators=40, max_features=69, max_depth=50</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row1_col2" class="data row1 col2" >121702</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row1_col3" class="data row1 col3" >0.981</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row1_col4" class="data row1 col4" >0.981</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row1_col5" class="data row1 col5" >0.89</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row1_col6" class="data row1 col6" >0.888</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row1_col7" class="data row1 col7" >0.868</td>
            </tr>
            <tr>
                        <th id="T_c6678f58_ebbd_11e9_a4bc_acde48001122level0_row2" class="row_heading level0 row2" >1</th>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row2_col0" class="data row2 col0" >Random Forest Regressor</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row2_col1" class="data row2 col1" >all orig features n_estimators=50</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row2_col2" class="data row2 col2" >125317</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row2_col3" class="data row2 col3" >0.981</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row2_col4" class="data row2 col4" >0.981</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row2_col5" class="data row2 col5" >0.883</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row2_col6" class="data row2 col6" >0.883</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row2_col7" class="data row2 col7" >0.872</td>
            </tr>
            <tr>
                        <th id="T_c6678f58_ebbd_11e9_a4bc_acde48001122level0_row3" class="row_heading level0 row3" >0</th>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row3_col0" class="data row3 col0" >Random Forest Regressor</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row3_col1" class="data row3 col1" >all orig features</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row3_col2" class="data row3 col2" >130835</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row3_col3" class="data row3 col3" >0.974</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row3_col4" class="data row3 col4" >0.974</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row3_col5" class="data row3 col5" >0.873</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row3_col6" class="data row3 col6" >0.872</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row3_col7" class="data row3 col7" >0.86</td>
            </tr>
            <tr>
                        <th id="T_c6678f58_ebbd_11e9_a4bc_acde48001122level0_row4" class="row_heading level0 row4" >2</th>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row4_col0" class="data row4 col0" >Random Forest Regressor</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row4_col1" class="data row4 col1" >all encoded features</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row4_col2" class="data row4 col2" >132481</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row4_col3" class="data row4 col3" >0.975</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row4_col4" class="data row4 col4" >0.975</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row4_col5" class="data row4 col5" >0.87</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row4_col6" class="data row4 col6" >0.868</td>
                        <td id="T_c6678f58_ebbd_11e9_a4bc_acde48001122row4_col7" class="data row4 col7" >0.86</td>
            </tr>
    </tbody></table>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Feature-Importance">Feature Importance<a class="anchor-link" href="#Feature-Importance"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">importances</span> <span class="o">=</span> <span class="n">grid_search_forest</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">importances</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([2.74192655e-03, 6.52461883e-03, 5.18007921e-01, 1.38699937e-02,
       2.54835769e-02, 4.62482004e-03, 1.27342271e-02, 1.59266272e-03,
       1.79397409e-01, 7.05908879e-02, 4.30063724e-02, 1.43828957e-02,
       1.84385123e-03, 3.89998170e-04, 2.69831043e-04, 1.23662253e-02,
       1.40485087e-02, 1.80969621e-02, 4.76377495e-03, 3.12577404e-04,
       7.13343216e-04, 8.99152948e-04, 8.94896294e-03, 1.08122782e-04,
       2.34225164e-04, 1.28652314e-03, 8.36194392e-04, 1.09504027e-03,
       2.02047259e-09, 4.31977482e-03, 2.97704944e-03, 4.74462977e-03,
       3.32560089e-04, 7.23933839e-07, 1.25850027e-05, 8.67799688e-05,
       5.14956415e-04, 5.58210139e-03, 3.88856349e-03, 3.10753442e-03,
       4.20970555e-03, 1.03636174e-03, 1.98531117e-04, 1.69926143e-04,
       1.26626752e-03, 5.70068492e-05, 1.27688907e-04, 8.53455848e-05,
       1.08192016e-04, 4.05738749e-04, 4.76407431e-04, 3.50187037e-04,
       2.01864013e-04, 3.69848711e-04, 2.57681711e-04, 5.04764003e-04,
       2.17125517e-04, 1.84100762e-04, 2.36291031e-04, 5.58276107e-04,
       5.85124138e-04, 1.42159788e-03, 4.22086382e-04, 5.70355692e-04,
       3.87860895e-04, 2.16539303e-04, 2.49575938e-04, 2.03609979e-04,
       1.84072711e-04])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_imp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span>
                      <span class="s1">&#39;importance&#39;</span><span class="p">:</span> <span class="n">importances</span><span class="p">})</span>

<span class="n">df_imp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;importance&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style  type="text/css" >
    #T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row0_col1 {
            background-color:  #023858;
            color:  #f1f1f1;
        }    #T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row1_col1 {
            background-color:  #b5c4df;
            color:  #000000;
        }    #T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row2_col1 {
            background-color:  #eee8f3;
            color:  #000000;
        }    #T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row3_col1 {
            background-color:  #f6eff7;
            color:  #000000;
        }    #T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row4_col1 {
            background-color:  #fbf4f9;
            color:  #000000;
        }    #T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row5_col1 {
            background-color:  #fef6fa;
            color:  #000000;
        }    #T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row6_col1 {
            background-color:  #fff7fb;
            color:  #000000;
        }    #T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row7_col1 {
            background-color:  #fff7fb;
            color:  #000000;
        }    #T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row8_col1 {
            background-color:  #fff7fb;
            color:  #000000;
        }    #T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row9_col1 {
            background-color:  #fff7fb;
            color:  #000000;
        }</style><table id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >feature</th>        <th class="col_heading level0 col1" >importance</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122level0_row0" class="row_heading level0 row0" >2</th>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row0_col0" class="data row0 col0" >sqft_living</td>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row0_col1" class="data row0 col1" >0.518008</td>
            </tr>
            <tr>
                        <th id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122level0_row1" class="row_heading level0 row1" >8</th>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row1_col0" class="data row1 col0" >lat</td>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row1_col1" class="data row1 col1" >0.179397</td>
            </tr>
            <tr>
                        <th id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122level0_row2" class="row_heading level0 row2" >9</th>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row2_col0" class="data row2 col0" >long</td>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row2_col1" class="data row2 col1" >0.0705909</td>
            </tr>
            <tr>
                        <th id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122level0_row3" class="row_heading level0 row3" >10</th>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row3_col0" class="data row3 col0" >sqft_living15</td>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row3_col1" class="data row3 col1" >0.0430064</td>
            </tr>
            <tr>
                        <th id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122level0_row4" class="row_heading level0 row4" >4</th>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row4_col0" class="data row4 col0" >sqft_above</td>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row4_col1" class="data row4 col1" >0.0254836</td>
            </tr>
            <tr>
                        <th id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122level0_row5" class="row_heading level0 row5" >17</th>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row5_col0" class="data row5 col0" >waterfront_1</td>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row5_col1" class="data row5 col1" >0.018097</td>
            </tr>
            <tr>
                        <th id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122level0_row6" class="row_heading level0 row6" >11</th>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row6_col0" class="data row6 col0" >sqft_lot15</td>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row6_col1" class="data row6 col1" >0.0143829</td>
            </tr>
            <tr>
                        <th id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122level0_row7" class="row_heading level0 row7" >16</th>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row7_col0" class="data row7 col0" >waterfront_0</td>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row7_col1" class="data row7 col1" >0.0140485</td>
            </tr>
            <tr>
                        <th id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122level0_row8" class="row_heading level0 row8" >3</th>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row8_col0" class="data row8 col0" >sqft_lot</td>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row8_col1" class="data row8 col1" >0.01387</td>
            </tr>
            <tr>
                        <th id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122level0_row9" class="row_heading level0 row9" >6</th>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row9_col0" class="data row9 col0" >yr_built</td>
                        <td id="T_c66d1fcc_ebbd_11e9_a4bc_acde48001122row9_col1" class="data row9 col1" >0.0127342</td>
            </tr>
    </tbody></table>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_imp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;importance&#39;</span><span class="p">],</span><span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style  type="text/css" >
    #T_c66fae4a_ebbd_11e9_a4bc_acde48001122row0_col1 {
            width:  10em;
             height:  80%;
            background:  linear-gradient(90deg,#d65f5f 100.0%, transparent 100.0%);
        }    #T_c66fae4a_ebbd_11e9_a4bc_acde48001122row1_col1 {
            width:  10em;
             height:  80%;
            background:  linear-gradient(90deg,#d65f5f 34.6%, transparent 34.6%);
        }    #T_c66fae4a_ebbd_11e9_a4bc_acde48001122row2_col1 {
            width:  10em;
             height:  80%;
            background:  linear-gradient(90deg,#d65f5f 13.6%, transparent 13.6%);
        }    #T_c66fae4a_ebbd_11e9_a4bc_acde48001122row3_col1 {
            width:  10em;
             height:  80%;
            background:  linear-gradient(90deg,#d65f5f 8.3%, transparent 8.3%);
        }    #T_c66fae4a_ebbd_11e9_a4bc_acde48001122row4_col1 {
            width:  10em;
             height:  80%;
            background:  linear-gradient(90deg,#d65f5f 4.9%, transparent 4.9%);
        }    #T_c66fae4a_ebbd_11e9_a4bc_acde48001122row5_col1 {
            width:  10em;
             height:  80%;
            background:  linear-gradient(90deg,#d65f5f 3.5%, transparent 3.5%);
        }    #T_c66fae4a_ebbd_11e9_a4bc_acde48001122row6_col1 {
            width:  10em;
             height:  80%;
            background:  linear-gradient(90deg,#d65f5f 2.8%, transparent 2.8%);
        }    #T_c66fae4a_ebbd_11e9_a4bc_acde48001122row7_col1 {
            width:  10em;
             height:  80%;
            background:  linear-gradient(90deg,#d65f5f 2.7%, transparent 2.7%);
        }    #T_c66fae4a_ebbd_11e9_a4bc_acde48001122row8_col1 {
            width:  10em;
             height:  80%;
            background:  linear-gradient(90deg,#d65f5f 2.7%, transparent 2.7%);
        }    #T_c66fae4a_ebbd_11e9_a4bc_acde48001122row9_col1 {
            width:  10em;
             height:  80%;
            background:  linear-gradient(90deg,#d65f5f 2.5%, transparent 2.5%);
        }</style><table id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >feature</th>        <th class="col_heading level0 col1" >importance</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122level0_row0" class="row_heading level0 row0" >2</th>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row0_col0" class="data row0 col0" >sqft_living</td>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row0_col1" class="data row0 col1" >0.518008</td>
            </tr>
            <tr>
                        <th id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122level0_row1" class="row_heading level0 row1" >8</th>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row1_col0" class="data row1 col0" >lat</td>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row1_col1" class="data row1 col1" >0.179397</td>
            </tr>
            <tr>
                        <th id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122level0_row2" class="row_heading level0 row2" >9</th>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row2_col0" class="data row2 col0" >long</td>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row2_col1" class="data row2 col1" >0.0705909</td>
            </tr>
            <tr>
                        <th id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122level0_row3" class="row_heading level0 row3" >10</th>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row3_col0" class="data row3 col0" >sqft_living15</td>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row3_col1" class="data row3 col1" >0.0430064</td>
            </tr>
            <tr>
                        <th id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122level0_row4" class="row_heading level0 row4" >4</th>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row4_col0" class="data row4 col0" >sqft_above</td>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row4_col1" class="data row4 col1" >0.0254836</td>
            </tr>
            <tr>
                        <th id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122level0_row5" class="row_heading level0 row5" >17</th>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row5_col0" class="data row5 col0" >waterfront_1</td>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row5_col1" class="data row5 col1" >0.018097</td>
            </tr>
            <tr>
                        <th id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122level0_row6" class="row_heading level0 row6" >11</th>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row6_col0" class="data row6 col0" >sqft_lot15</td>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row6_col1" class="data row6 col1" >0.0143829</td>
            </tr>
            <tr>
                        <th id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122level0_row7" class="row_heading level0 row7" >16</th>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row7_col0" class="data row7 col0" >waterfront_0</td>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row7_col1" class="data row7 col1" >0.0140485</td>
            </tr>
            <tr>
                        <th id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122level0_row8" class="row_heading level0 row8" >3</th>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row8_col0" class="data row8 col0" >sqft_lot</td>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row8_col1" class="data row8 col1" >0.01387</td>
            </tr>
            <tr>
                        <th id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122level0_row9" class="row_heading level0 row9" >6</th>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row9_col0" class="data row9 col0" >yr_built</td>
                        <td id="T_c66fae4a_ebbd_11e9_a4bc_acde48001122row9_col1" class="data row9 col1" >0.0127342</td>
            </tr>
    </tbody></table>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="feature-importance-using-yellowbrick">feature importance using yellowbrick<a class="anchor-link" href="#feature-importance-using-yellowbrick"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">yellowbrick.model_selection</span> <span class="k">import</span> <span class="n">FeatureImportances</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">50</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                              <span class="n">max_depth</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">df_Xtrain</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">features</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">viz</span> <span class="o">=</span> <span class="n">FeatureImportances</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">viz</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_Xtrain</span><span class="p">,</span> <span class="n">ytrain</span><span class="p">)</span>
<span class="n">viz</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/c05_regression_modelling_random_forest_feature_importance_33_0.png"
>
</div>

</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x12e9e1d68&gt;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">topN</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">top_cols</span> <span class="o">=</span> <span class="n">df_imp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">topN</span><span class="p">)[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">top_cols</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;bedrooms&#39;,
 &#39;bathrooms&#39;,
 &#39;sqft_living&#39;,
 &#39;sqft_lot&#39;,
 &#39;sqft_above&#39;,
 &#39;sqft_basement&#39;,
 &#39;yr_built&#39;,
 &#39;yr_renovated&#39;,
 &#39;lat&#39;,
 &#39;long&#39;]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(21613, 92)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Use-features-selection-to-refit-random-forest">Use features selection to refit random forest<a class="anchor-link" href="#Use-features-selection-to-refit-random-forest"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">grid_search_topNs</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">topN</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">90</span><span class="p">]:</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running for topN = &#39;</span><span class="p">,</span> <span class="n">topN</span><span class="p">)</span>
        <span class="n">top_cols</span> <span class="o">=</span> <span class="n">df_imp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">topN</span><span class="p">)[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">features</span> <span class="o">=</span> <span class="n">top_cols</span>
        <span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="n">features</span> <span class="o">+</span> <span class="n">target</span><span class="p">]</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">40</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">rmse</span><span class="p">,</span> <span class="n">r2_train</span><span class="p">,</span> <span class="n">ar2_train</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="n">ar2_test</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> \
            <span class="n">multiple_linear_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">model</span><span class="p">,</span>
                                       <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>


        <span class="n">df_eval</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_eval</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Random Forest Regressor&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;n_estimators = 40, max_depth = 50,</span><span class="se">\</span>
<span class="s1">                                     topN features = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">topN</span><span class="p">),</span>
                                     <span class="n">rmse</span><span class="p">,</span><span class="n">r2_train</span><span class="p">,</span><span class="n">ar2_train</span><span class="p">,</span>
                                     <span class="n">r2_test</span><span class="p">,</span><span class="n">ar2_test</span><span class="p">,</span><span class="n">cv</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">topN</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">top_cols</span> <span class="o">=</span> <span class="n">df_imp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">topN</span><span class="p">)[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">features</span> <span class="o">=</span> <span class="n">top_cols</span>
<span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="n">features</span> <span class="o">+</span> <span class="n">target</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">50</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                              <span class="n">max_depth</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">rmse</span><span class="p">,</span> <span class="n">r2_train</span><span class="p">,</span> <span class="n">ar2_train</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="n">ar2_test</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> \
    <span class="n">multiple_linear_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">model</span><span class="p">,</span>
                               <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">df_eval</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_eval</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Random Forest Regressor&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;n_estimators = 50, max_depth = 50,</span><span class="se">\</span>
<span class="s1">                             topN features = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">topN</span><span class="p">),</span>
                             <span class="n">rmse</span><span class="p">,</span><span class="n">r2_train</span><span class="p">,</span><span class="n">ar2_train</span><span class="p">,</span>
                             <span class="n">r2_test</span><span class="p">,</span><span class="n">ar2_test</span><span class="p">,</span><span class="n">cv</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 4 concurrent workers.
[Parallel(n_jobs=-1)]: Done   5 out of   5 | elapsed:   17.1s finished
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_eval</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Adjusted R-squared (test)&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style  type="text/css" >
    #T_d4775efc_ebbd_11e9_a4bc_acde48001122row0_col6 {
            background-color:  #023858;
            color:  #f1f1f1;
        }    #T_d4775efc_ebbd_11e9_a4bc_acde48001122row1_col6 {
            background-color:  #03446a;
            color:  #f1f1f1;
        }    #T_d4775efc_ebbd_11e9_a4bc_acde48001122row2_col6 {
            background-color:  #03517e;
            color:  #f1f1f1;
        }    #T_d4775efc_ebbd_11e9_a4bc_acde48001122row3_col6 {
            background-color:  #2081b9;
            color:  #000000;
        }    #T_d4775efc_ebbd_11e9_a4bc_acde48001122row4_col6 {
            background-color:  #e0dded;
            color:  #000000;
        }    #T_d4775efc_ebbd_11e9_a4bc_acde48001122row5_col6 {
            background-color:  #fff7fb;
            color:  #000000;
        }</style><table id="T_d4775efc_ebbd_11e9_a4bc_acde48001122" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >Model</th>        <th class="col_heading level0 col1" >Details</th>        <th class="col_heading level0 col2" >Root Mean Squared Error (RMSE)</th>        <th class="col_heading level0 col3" >R-squared (training)</th>        <th class="col_heading level0 col4" >Adjusted R-squared (training)</th>        <th class="col_heading level0 col5" >R-squared (test)</th>        <th class="col_heading level0 col6" >Adjusted R-squared (test)</th>        <th class="col_heading level0 col7" >5-Fold Cross Validation</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_d4775efc_ebbd_11e9_a4bc_acde48001122level0_row0" class="row_heading level0 row0" >5</th>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row0_col0" class="data row0 col0" >Random Forest Regressor</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row0_col1" class="data row0 col1" >n_estimators = 50, max_depth = 50,                             topN features = 40</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row0_col2" class="data row0 col2" >121221</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row0_col3" class="data row0 col3" >0.981</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row0_col4" class="data row0 col4" >0.981</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row0_col5" class="data row0 col5" >0.891</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row0_col6" class="data row0 col6" >0.89</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row0_col7" class="data row0 col7" >0.87</td>
            </tr>
            <tr>
                        <th id="T_d4775efc_ebbd_11e9_a4bc_acde48001122level0_row1" class="row_heading level0 row1" >3</th>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row1_col0" class="data row1 col0" >Random Forest Regressor</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row1_col1" class="data row1 col1" >all encoded features, n_estimators=50</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row1_col2" class="data row1 col2" >121276</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row1_col3" class="data row1 col3" >0.982</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row1_col4" class="data row1 col4" >0.982</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row1_col5" class="data row1 col5" >0.891</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row1_col6" class="data row1 col6" >0.889</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row1_col7" class="data row1 col7" >0.87</td>
            </tr>
            <tr>
                        <th id="T_d4775efc_ebbd_11e9_a4bc_acde48001122level0_row2" class="row_heading level0 row2" >4</th>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row2_col0" class="data row2 col0" >Random Forest Regressor after grid search</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row2_col1" class="data row2 col1" > all encoded features, best grid search,                             n_estimators=40, max_features=69, max_depth=50</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row2_col2" class="data row2 col2" >121702</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row2_col3" class="data row2 col3" >0.981</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row2_col4" class="data row2 col4" >0.981</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row2_col5" class="data row2 col5" >0.89</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row2_col6" class="data row2 col6" >0.888</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row2_col7" class="data row2 col7" >0.868</td>
            </tr>
            <tr>
                        <th id="T_d4775efc_ebbd_11e9_a4bc_acde48001122level0_row3" class="row_heading level0 row3" >1</th>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row3_col0" class="data row3 col0" >Random Forest Regressor</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row3_col1" class="data row3 col1" >all orig features n_estimators=50</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row3_col2" class="data row3 col2" >125317</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row3_col3" class="data row3 col3" >0.981</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row3_col4" class="data row3 col4" >0.981</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row3_col5" class="data row3 col5" >0.883</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row3_col6" class="data row3 col6" >0.883</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row3_col7" class="data row3 col7" >0.872</td>
            </tr>
            <tr>
                        <th id="T_d4775efc_ebbd_11e9_a4bc_acde48001122level0_row4" class="row_heading level0 row4" >0</th>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row4_col0" class="data row4 col0" >Random Forest Regressor</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row4_col1" class="data row4 col1" >all orig features</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row4_col2" class="data row4 col2" >130835</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row4_col3" class="data row4 col3" >0.974</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row4_col4" class="data row4 col4" >0.974</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row4_col5" class="data row4 col5" >0.873</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row4_col6" class="data row4 col6" >0.872</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row4_col7" class="data row4 col7" >0.86</td>
            </tr>
            <tr>
                        <th id="T_d4775efc_ebbd_11e9_a4bc_acde48001122level0_row5" class="row_heading level0 row5" >2</th>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row5_col0" class="data row5 col0" >Random Forest Regressor</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row5_col1" class="data row5 col1" >all encoded features</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row5_col2" class="data row5 col2" >132481</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row5_col3" class="data row5 col3" >0.975</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row5_col4" class="data row5 col4" >0.975</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row5_col5" class="data row5 col5" >0.87</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row5_col6" class="data row5 col6" >0.868</td>
                        <td id="T_d4775efc_ebbd_11e9_a4bc_acde48001122row5_col7" class="data row5 col7" >0.86</td>
            </tr>
    </tbody></table>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Feature-Importances-using-yellowbricks">Feature Importances using yellowbricks<a class="anchor-link" href="#Feature-Importances-using-yellowbricks"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span><span class="mi">8</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">yellowbrick.features</span> <span class="k">import</span> <span class="n">Rank1D</span>
<span class="kn">from</span> <span class="nn">yellowbrick.features</span> <span class="k">import</span> <span class="n">Rank2D</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">topN</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">top_cols</span> <span class="o">=</span> <span class="n">df_imp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">topN</span><span class="p">)[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">features</span> <span class="o">=</span> <span class="n">top_cols</span>
<span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="n">features</span> <span class="o">+</span> <span class="n">target</span><span class="p">]</span>

<span class="c1"># train test split</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># train test values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">Xtrain</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ytrain</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">Xtest</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ytest</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">50</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                              <span class="n">max_depth</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>


<span class="c1"># Instantiate the visualizer with the Pearson ranking algorithm</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">Rank1D</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">top_cols</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;shapiro&#39;</span><span class="p">)</span> 


<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span> <span class="n">ytrain</span><span class="p">)</span>                
<span class="n">visualizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">)</span>             
<span class="n">visualizer</span><span class="o">.</span><span class="n">poof</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/poudel/miniconda3/envs/dataSc/lib/python3.7/site-packages/scipy/stats/morestats.py:1660: UserWarning: p-value may not be accurate for N &gt; 5000.
  warnings.warn(&#34;p-value may not be accurate for N &gt; 5000.&#34;)
/Users/poudel/miniconda3/envs/dataSc/lib/python3.7/site-packages/yellowbrick/features/rankd.py:216: YellowbrickWarning: RankD plots may be clipped when using matplotlib v3.1.1, upgrade to matplotlib v3.1.2 or later to fix the plots.
  warnings.warn(msg, YellowbrickWarning)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/c05_regression_modelling_random_forest_feature_importance_42_1.png"
>
</div>

</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x12fdc1f98&gt;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">topN</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">top_cols</span> <span class="o">=</span> <span class="n">df_imp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">topN</span><span class="p">)[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">features</span> <span class="o">=</span> <span class="n">top_cols</span>
<span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="n">features</span> <span class="o">+</span> <span class="n">target</span><span class="p">]</span>

<span class="c1"># train test split</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># train test values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">Xtrain</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ytrain</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">Xtest</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ytest</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">50</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                              <span class="n">max_depth</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>


<span class="c1"># Instantiate the visualizer with the Pearson ranking algorithm</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">Rank2D</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">top_cols</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;covariance&#39;</span><span class="p">)</span> 

<span class="c1">#visualizer = Rank2D(features=feature_names, algorithm=&#39;pearson&#39;)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span> <span class="n">ytrain</span><span class="p">)</span>                
<span class="n">visualizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">)</span>             
<span class="n">visualizer</span><span class="o">.</span><span class="n">poof</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/poudel/miniconda3/envs/dataSc/lib/python3.7/site-packages/yellowbrick/features/rankd.py:216: YellowbrickWarning: RankD plots may be clipped when using matplotlib v3.1.1, upgrade to matplotlib v3.1.2 or later to fix the plots.
  warnings.warn(msg, YellowbrickWarning)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/c05_regression_modelling_random_forest_feature_importance_43_1.png"
>
</div>

</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1333e7400&gt;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

 


    </main>
    