---
redirect_from:
  - "d01-regression-modelling-using-pyspark"
interact_link: content/d01_regression_modelling_using_pyspark.ipynb
kernel_name: spk
kernel_path: content
has_widgets: false
title: |-
  D01 Regression Modelling Using Pyspark
pagenum: 0
prev_page:
  url: 
next_page:
  url: /a02_regression_data_processing_script.html
suffix: .ipynb
search: toc span data class id features href modified item lilispana evaluation num nbspnbsp model numnbspnbsp feature variables numerical regression regressor categorical ml itemlispana description scripts engineering binned transform large column li ul scaling test splitting spanmodel predictions metrics using net tree forest tuning importances imports useful load eda spanfeature spanul temporal boolean bucketizing dummy log combine train modelling linear elastic decision random parameter div house includes price htable contentsspan tocskip h tocul spandata spanimports spanuseful spanload spaneda spantemporal spancategorical spanboolean spanbucketizing spandummy spanlog spancombine spantrain spanmodelling spanlinear spanelastic spandecision spanrandom spanparameter dataset contains sale prices king county seattle homes sold

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">D01 Regression Modelling Using Pyspark</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h1>Table of Contents<span class="tocSkip"></span></h1></p>
<div class="toc"><ul class="toc-item"><li><span><a href="#Data-Description" data-toc-modified-id="Data-Description-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Data Description</a></span></li><li><span><a href="#Imports" data-toc-modified-id="Imports-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Imports</a></span></li><li><span><a href="#Useful-Scripts" data-toc-modified-id="Useful-Scripts-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>Useful Scripts</a></span></li><li><span><a href="#Load-the-data" data-toc-modified-id="Load-the-data-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>Load the data</a></span></li><li><span><a href="#EDA" data-toc-modified-id="EDA-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>EDA</a></span></li><li><span><a href="#Feature-Engineering" data-toc-modified-id="Feature-Engineering-6"><span class="toc-item-num">6&nbsp;&nbsp;</span>Feature Engineering</a></span><ul class="toc-item"><li><span><a href="#Temporal-Variables" data-toc-modified-id="Temporal-Variables-6.1"><span class="toc-item-num">6.1&nbsp;&nbsp;</span>Temporal Variables</a></span></li><li><span><a href="#Categorical-Features" data-toc-modified-id="Categorical-Features-6.2"><span class="toc-item-num">6.2&nbsp;&nbsp;</span>Categorical Features</a></span></li><li><span><a href="#Boolean-Features" data-toc-modified-id="Boolean-Features-6.3"><span class="toc-item-num">6.3&nbsp;&nbsp;</span>Boolean Features</a></span></li><li><span><a href="#Bucketizing-Numerical-Features" data-toc-modified-id="Bucketizing-Numerical-Features-6.4"><span class="toc-item-num">6.4&nbsp;&nbsp;</span>Bucketizing Numerical Features</a></span></li><li><span><a href="#Dummy-Variables-for-Binned-and-Categorical-Features" data-toc-modified-id="Dummy-Variables-for-Binned-and-Categorical-Features-6.5"><span class="toc-item-num">6.5&nbsp;&nbsp;</span>Dummy Variables for Binned and Categorical Features</a></span></li><li><span><a href="#Log-Transform-Large-Numerical-Features" data-toc-modified-id="Log-Transform-Large-Numerical-Features-6.6"><span class="toc-item-num">6.6&nbsp;&nbsp;</span>Log Transform Large Numerical Features</a></span></li><li><span><a href="#Combine-All-Features-to-One-Column" data-toc-modified-id="Combine-All-Features-to-One-Column-6.7"><span class="toc-item-num">6.7&nbsp;&nbsp;</span>Combine All Features to One Column</a></span></li></ul></li><li><span><a href="#Feature-Scaling" data-toc-modified-id="Feature-Scaling-7"><span class="toc-item-num">7&nbsp;&nbsp;</span>Feature Scaling</a></span></li><li><span><a href="#Train-Test-Splitting" data-toc-modified-id="Train-Test-Splitting-8"><span class="toc-item-num">8&nbsp;&nbsp;</span>Train Test Splitting</a></span></li><li><span><a href="#Modelling" data-toc-modified-id="Modelling-9"><span class="toc-item-num">9&nbsp;&nbsp;</span>Modelling</a></span><ul class="toc-item"><li><span><a href="#Linear-Regression" data-toc-modified-id="Linear-Regression-9.1"><span class="toc-item-num">9.1&nbsp;&nbsp;</span>Linear Regression</a></span><ul class="toc-item"><li><span><a href="#Model-Evaluation" data-toc-modified-id="Model-Evaluation-9.1.1"><span class="toc-item-num">9.1.1&nbsp;&nbsp;</span>Model Evaluation</a></span></li><li><span><a href="#Model-Predictions" data-toc-modified-id="Model-Predictions-9.1.2"><span class="toc-item-num">9.1.2&nbsp;&nbsp;</span>Model Predictions</a></span></li><li><span><a href="#Model-Evaluation-Metrics" data-toc-modified-id="Model-Evaluation-Metrics-9.1.3"><span class="toc-item-num">9.1.3&nbsp;&nbsp;</span>Model Evaluation Metrics</a></span></li><li><span><a href="#Model-Evaluation-using-ml.evaluation" data-toc-modified-id="Model-Evaluation-using-ml.evaluation-9.1.4"><span class="toc-item-num">9.1.4&nbsp;&nbsp;</span>Model Evaluation using ml.evaluation</a></span></li></ul></li><li><span><a href="#Elastic-Net-Regression" data-toc-modified-id="Elastic-Net-Regression-9.2"><span class="toc-item-num">9.2&nbsp;&nbsp;</span>Elastic Net Regression</a></span></li><li><span><a href="#Decision-Tree-Regressor" data-toc-modified-id="Decision-Tree-Regressor-9.3"><span class="toc-item-num">9.3&nbsp;&nbsp;</span>Decision Tree Regressor</a></span></li><li><span><a href="#Random-Forest-Regressor" data-toc-modified-id="Random-Forest-Regressor-9.4"><span class="toc-item-num">9.4&nbsp;&nbsp;</span>Random Forest Regressor</a></span></li><li><span><a href="#Parameter-Tuning" data-toc-modified-id="Parameter-Tuning-9.5"><span class="toc-item-num">9.5&nbsp;&nbsp;</span>Parameter Tuning</a></span></li></ul></li><li><span><a href="#Feature-Importances" data-toc-modified-id="Feature-Importances-10"><span class="toc-item-num">10&nbsp;&nbsp;</span>Feature Importances</a></span></li></ul></div>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Data-Description">Data Description<a class="anchor-link" href="#Data-Description"> </a></h1><p>This dataset contains house sale prices for King County,
which includes Seattle.
It includes homes sold between May 2014 and May 2015.</p>
<ul>
<li>Dependent features: 1 (price)</li>
<li>Features : 19 home features</li>
<li>Id:  1 house ID</li>
</ul>
<p>Task: Try to estimate the price based on given features.
<img src="../data/raw/data_description.png" alt=""></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Imports">Imports<a class="anchor-link" href="#Imports"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color_codes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># random state</span>
<span class="n">random_state</span><span class="o">=</span><span class="mi">100</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span> <span class="c1"># we need this in each cell</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_state</span><span class="o">=</span><span class="n">random_state</span>

<span class="c1"># Jupyter notebook settings for pandas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># None for all the rows</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="nb">print</span><span class="p">([(</span><span class="n">x</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span><span class="n">sns</span><span class="p">,</span><span class="n">matplotlib</span><span class="p">]])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[(&#39;numpy&#39;, &#39;1.17.1&#39;), (&#39;pandas&#39;, &#39;0.25.1&#39;), (&#39;seaborn&#39;, &#39;0.9.0&#39;), (&#39;matplotlib&#39;, &#39;3.1.1&#39;)]
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="nx">javascript</span>
<span class="nx">IPython</span><span class="p">.</span><span class="nx">OutputArea</span><span class="p">.</span><span class="nx">auto_scroll_threshold</span> <span class="o">=</span> <span class="mi">9999</span><span class="p">;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">




<div id="25eb54be-0fcf-4e39-8f97-85305af52bae"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#25eb54be-0fcf-4e39-8f97-85305af52bae');
IPython.OutputArea.auto_scroll_threshold = 9999;

</script>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># pyspark</span>
<span class="kn">import</span> <span class="nn">pyspark</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s1">&#39;bhishan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="nb">print</span><span class="p">([(</span><span class="n">x</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">pyspark</span><span class="p">]])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[(&#39;numpy&#39;, &#39;1.17.1&#39;), (&#39;pandas&#39;, &#39;0.25.1&#39;), (&#39;pyspark&#39;, &#39;2.4.4&#39;)]
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># pyspark sql</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="k">import</span> <span class="n">col</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="k">import</span> <span class="n">udf</span> <span class="c1"># @udf(&quot;integer&quot;) def myfunc(x,y): return x - y</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="k">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span> <span class="c1"># stddev format_number date_format, dayofyear, when</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="k">import</span> <span class="n">StructField</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">,</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">DateType</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># pyspark ml feature</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="k">import</span> <span class="n">StringIndexer</span><span class="p">,</span> <span class="n">VectorIndexer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="k">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span><span class="n">OneHotEncoderEstimator</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="k">import</span> <span class="n">Bucketizer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="k">import</span> <span class="n">VectorAssembler</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="k">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="k">import</span> <span class="n">Pipeline</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># regressors</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="k">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="k">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="k">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="k">import</span> <span class="n">GBTRegressor</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># cross validation</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.tuning</span> <span class="k">import</span> <span class="n">ParamGridBuilder</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.tuning</span> <span class="k">import</span> <span class="n">CrossValidator</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.tuning</span> <span class="k">import</span> <span class="n">CrossValidatorModel</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># model evaluation regression</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="k">import</span> <span class="n">RegressionEvaluator</span>
<span class="kn">from</span> <span class="nn">pyspark.mllib.evaluation</span> <span class="k">import</span> <span class="n">RegressionMetrics</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Useful-Scripts">Useful Scripts<a class="anchor-link" href="#Useful-Scripts"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">show_method_attributes</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Show all the attributes of a given method.</span>
<span class="sd">    Example:</span>
<span class="sd">    ========</span>
<span class="sd">    show_method_attributes(list)</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">I</span> <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="k">if</span> <span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">()]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">I</span> <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span> <span class="n">I</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;os np pd sys time psycopg2&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ncols</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Load-the-data">Load the data<a class="anchor-link" href="#Load-the-data"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>head  ../data/raw/kc_house_data.csv
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>id,date,price,bedrooms,bathrooms,sqft_living,sqft_lot,floors,waterfront,view,condition,grade,sqft_above,sqft_basement,yr_built,yr_renovated,zipcode,lat,long,sqft_living15,sqft_lot15
&#34;7129300520&#34;,&#34;20141013T000000&#34;,221900,3,1,1180,5650,&#34;1&#34;,0,0,3,7,1180,0,1955,0,&#34;98178&#34;,47.5112,-122.257,1340,5650
&#34;6414100192&#34;,&#34;20141209T000000&#34;,538000,3,2.25,2570,7242,&#34;2&#34;,0,0,3,7,2170,400,1951,1991,&#34;98125&#34;,47.721,-122.319,1690,7639
&#34;5631500400&#34;,&#34;20150225T000000&#34;,180000,2,1,770,10000,&#34;1&#34;,0,0,3,6,770,0,1933,0,&#34;98028&#34;,47.7379,-122.233,2720,8062
&#34;2487200875&#34;,&#34;20141209T000000&#34;,604000,4,3,1960,5000,&#34;1&#34;,0,0,5,7,1050,910,1965,0,&#34;98136&#34;,47.5208,-122.393,1360,5000
&#34;1954400510&#34;,&#34;20150218T000000&#34;,510000,3,2,1680,8080,&#34;1&#34;,0,0,3,8,1680,0,1987,0,&#34;98074&#34;,47.6168,-122.045,1800,7503
&#34;7237550310&#34;,&#34;20140512T000000&#34;,1.225e+006,4,4.5,5420,101930,&#34;1&#34;,0,0,3,11,3890,1530,2001,0,&#34;98053&#34;,47.6561,-122.005,4760,101930
&#34;1321400060&#34;,&#34;20140627T000000&#34;,257500,3,2.25,1715,6819,&#34;2&#34;,0,0,3,7,1715,0,1995,0,&#34;98003&#34;,47.3097,-122.327,2238,6819
&#34;2008000270&#34;,&#34;20150115T000000&#34;,291850,3,1.5,1060,9711,&#34;1&#34;,0,0,3,7,1060,0,1963,0,&#34;98198&#34;,47.4095,-122.315,1650,9711
&#34;2414600126&#34;,&#34;20150415T000000&#34;,229500,3,1,1780,7470,&#34;1&#34;,0,0,3,7,1050,730,1960,0,&#34;98146&#34;,47.5123,-122.337,1780,8113
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s1">&#39;../data/raw/kc_house_data.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nrows = &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="s1">&#39;ncols = &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>nrows =  21613 ncols =  21
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>date</th>
      <th>price</th>
      <th>bedrooms</th>
      <th>bathrooms</th>
      <th>sqft_living</th>
      <th>sqft_lot</th>
      <th>floors</th>
      <th>waterfront</th>
      <th>view</th>
      <th>condition</th>
      <th>grade</th>
      <th>sqft_above</th>
      <th>sqft_basement</th>
      <th>yr_built</th>
      <th>yr_renovated</th>
      <th>zipcode</th>
      <th>lat</th>
      <th>long</th>
      <th>sqft_living15</th>
      <th>sqft_lot15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>7129300520</td>
      <td>20141013T000000</td>
      <td>221900</td>
      <td>3</td>
      <td>1.00</td>
      <td>1180</td>
      <td>5650</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>1180</td>
      <td>0</td>
      <td>1955</td>
      <td>0</td>
      <td>98178</td>
      <td>47.5112</td>
      <td>-122.257</td>
      <td>1340</td>
      <td>5650</td>
    </tr>
    <tr>
      <td>1</td>
      <td>6414100192</td>
      <td>20141209T000000</td>
      <td>538000</td>
      <td>3</td>
      <td>2.25</td>
      <td>2570</td>
      <td>7242</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>2170</td>
      <td>400</td>
      <td>1951</td>
      <td>1991</td>
      <td>98125</td>
      <td>47.7210</td>
      <td>-122.319</td>
      <td>1690</td>
      <td>7639</td>
    </tr>
    <tr>
      <td>2</td>
      <td>5631500400</td>
      <td>20150225T000000</td>
      <td>180000</td>
      <td>2</td>
      <td>1.00</td>
      <td>770</td>
      <td>10000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>6</td>
      <td>770</td>
      <td>0</td>
      <td>1933</td>
      <td>0</td>
      <td>98028</td>
      <td>47.7379</td>
      <td>-122.233</td>
      <td>2720</td>
      <td>8062</td>
    </tr>
    <tr>
      <td>3</td>
      <td>2487200875</td>
      <td>20141209T000000</td>
      <td>604000</td>
      <td>4</td>
      <td>3.00</td>
      <td>1960</td>
      <td>5000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>7</td>
      <td>1050</td>
      <td>910</td>
      <td>1965</td>
      <td>0</td>
      <td>98136</td>
      <td>47.5208</td>
      <td>-122.393</td>
      <td>1360</td>
      <td>5000</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1954400510</td>
      <td>20150218T000000</td>
      <td>510000</td>
      <td>3</td>
      <td>2.00</td>
      <td>1680</td>
      <td>8080</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>8</td>
      <td>1680</td>
      <td>0</td>
      <td>1987</td>
      <td>0</td>
      <td>98074</td>
      <td>47.6168</td>
      <td>-122.045</td>
      <td>1800</td>
      <td>7503</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>root
 |-- id: long (nullable = true)
 |-- date: string (nullable = true)
 |-- price: decimal(7,0) (nullable = true)
 |-- bedrooms: integer (nullable = true)
 |-- bathrooms: double (nullable = true)
 |-- sqft_living: integer (nullable = true)
 |-- sqft_lot: integer (nullable = true)
 |-- floors: double (nullable = true)
 |-- waterfront: integer (nullable = true)
 |-- view: integer (nullable = true)
 |-- condition: integer (nullable = true)
 |-- grade: integer (nullable = true)
 |-- sqft_above: integer (nullable = true)
 |-- sqft_basement: integer (nullable = true)
 |-- yr_built: integer (nullable = true)
 |-- yr_renovated: integer (nullable = true)
 |-- zipcode: integer (nullable = true)
 |-- lat: double (nullable = true)
 |-- long: double (nullable = true)
 |-- sqft_living15: integer (nullable = true)
 |-- sqft_lot15: integer (nullable = true)

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;id&#39;, &#39;date&#39;, &#39;price&#39;, &#39;bedrooms&#39;, &#39;bathrooms&#39;, &#39;sqft_living&#39;, &#39;sqft_lot&#39;, &#39;floors&#39;, &#39;waterfront&#39;, &#39;view&#39;, &#39;condition&#39;, &#39;grade&#39;, &#39;sqft_above&#39;, &#39;sqft_basement&#39;, &#39;yr_built&#39;, &#39;yr_renovated&#39;, &#39;zipcode&#39;, &#39;lat&#39;, &#39;long&#39;, &#39;sqft_living15&#39;, &#39;sqft_lot15&#39;]
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="EDA">EDA<a class="anchor-link" href="#EDA"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s1">&#39;price&#39;</span><span class="p">,</span><span class="s1">&#39;sqft_living&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+-----------+
| price|sqft_living|
+------+-----------+
|221900|       1180|
|538000|       2570|
|180000|        770|
|604000|       1960|
|510000|       1680|
+------+-----------+
only showing top 5 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+-----------+----------+
| avg(price)|max(price)|
+-----------+----------+
|540088.1418|   7700000|
+-----------+----------+

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">x</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sqft_living&#39;</span><span class="p">])</span> 
           <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">F</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">min</span> <span class="p">]])</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------------+----------------+
|max(sqft_living)|min(sqft_living)|
+----------------+----------------+
|           13540|             290|
+----------------+----------------+

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;grade&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+-----+
|grade|
+-----+
|   12|
|    1|
|   13|
|    6|
|    3|
|    5|
|    9|
|    4|
|    8|
|    7|
|   10|
|   11|
+-----+

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s1">&#39;bedrooms&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------+----------+
|bedrooms|max(price)|
+--------+----------+
|       1|   1247000|
|       6|   7700000|
|       3|   3800000|
|       5|   7062500|
|       9|   1400000|
|       4|   4489000|
|       8|   3300000|
|       7|   3200000|
|      10|   1148000|
|      11|    520000|
|      33|    640000|
|       2|   3278000|
|       0|   1295650|
+--------+----------+

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;grade&#39;</span><span class="p">:</span> <span class="s1">&#39;count&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+------------+
|count(grade)|
+------------+
|       21613|
+------------+

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s1">&#39;2014%&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+---------------+
|           date|
+---------------+
|20141013T000000|
|20141209T000000|
+---------------+
only showing top 2 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;bedrooms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+--------+
|        id|bedrooms|
+----------+--------+
|5631500400|       2|
|9212900260|       2|
+----------+--------+
only showing top 2 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">view_grp</span> <span class="o">=</span>  <span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;view&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;view&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">view_grp</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x118ad42d0&gt;</pre>
</div>

</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/d01_regression_modelling_using_pyspark_28_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>price</th>
      <th>bedrooms</th>
      <th>bathrooms</th>
      <th>sqft_living</th>
      <th>sqft_lot</th>
      <th>floors</th>
      <th>waterfront</th>
      <th>view</th>
      <th>condition</th>
      <th>grade</th>
      <th>sqft_above</th>
      <th>sqft_basement</th>
      <th>yr_built</th>
      <th>yr_renovated</th>
      <th>zipcode</th>
      <th>lat</th>
      <th>long</th>
      <th>sqft_living15</th>
      <th>sqft_lot15</th>
    </tr>
    <tr>
      <th>summary</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>count</td>
      <td>2.161300e+04</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
      <td>21613.000</td>
    </tr>
    <tr>
      <td>mean</td>
      <td>4.580302e+09</td>
      <td>540088.142</td>
      <td>3.371</td>
      <td>2.115</td>
      <td>2079.900</td>
      <td>15106.968</td>
      <td>1.494</td>
      <td>0.008</td>
      <td>0.234</td>
      <td>3.409</td>
      <td>7.657</td>
      <td>1788.391</td>
      <td>291.509</td>
      <td>1971.005</td>
      <td>84.402</td>
      <td>98077.940</td>
      <td>47.560</td>
      <td>-122.214</td>
      <td>1986.552</td>
      <td>12768.456</td>
    </tr>
    <tr>
      <td>stddev</td>
      <td>2.876566e+09</td>
      <td>367127.196</td>
      <td>0.930</td>
      <td>0.770</td>
      <td>918.441</td>
      <td>41420.512</td>
      <td>0.540</td>
      <td>0.087</td>
      <td>0.766</td>
      <td>0.651</td>
      <td>1.175</td>
      <td>828.091</td>
      <td>442.575</td>
      <td>29.373</td>
      <td>401.679</td>
      <td>53.505</td>
      <td>0.139</td>
      <td>0.141</td>
      <td>685.391</td>
      <td>27304.180</td>
    </tr>
    <tr>
      <td>min</td>
      <td>1.000102e+06</td>
      <td>75000.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>290.000</td>
      <td>520.000</td>
      <td>1.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.000</td>
      <td>1.000</td>
      <td>290.000</td>
      <td>0.000</td>
      <td>1900.000</td>
      <td>0.000</td>
      <td>98001.000</td>
      <td>47.156</td>
      <td>-122.519</td>
      <td>399.000</td>
      <td>651.000</td>
    </tr>
    <tr>
      <td>max</td>
      <td>9.900000e+09</td>
      <td>7700000.000</td>
      <td>33.000</td>
      <td>8.000</td>
      <td>13540.000</td>
      <td>1651359.000</td>
      <td>3.500</td>
      <td>1.000</td>
      <td>4.000</td>
      <td>5.000</td>
      <td>13.000</td>
      <td>9410.000</td>
      <td>4820.000</td>
      <td>2015.000</td>
      <td>2015.000</td>
      <td>98199.000</td>
      <td>47.778</td>
      <td>-121.315</td>
      <td>6210.000</td>
      <td>871200.000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Feature-Engineering">Feature Engineering<a class="anchor-link" href="#Feature-Engineering"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Temporal-Variables">Temporal Variables<a class="anchor-link" href="#Temporal-Variables"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;yr_sales&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;yr_sales&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+---------------+--------+
|           date|yr_sales|
+---------------+--------+
|20141013T000000|    2014|
|20141209T000000|    2014|
+---------------+--------+
only showing top 2 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;yr_sales&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;yr_built&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;yr_sales&#39;</span><span class="p">,</span><span class="s1">&#39;yr_built&#39;</span><span class="p">,</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------+--------+---+
|yr_sales|yr_built|age|
+--------+--------+---+
|    2014|    1955| 59|
|    2014|    1951| 63|
|    2015|    1933| 82|
|    2014|    1965| 49|
|    2015|    1987| 28|
+--------+--------+---+
only showing top 5 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+-------+------------------+
|summary|               age|
+-------+------------------+
|  count|             21613|
|   mean| 43.31781797991949|
| stddev|29.375492803877584|
|    min|                -1|
|    max|               115|
+-------+------------------+

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>date</th>
      <th>price</th>
      <th>bedrooms</th>
      <th>bathrooms</th>
      <th>sqft_living</th>
      <th>sqft_lot</th>
      <th>floors</th>
      <th>waterfront</th>
      <th>view</th>
      <th>condition</th>
      <th>grade</th>
      <th>sqft_above</th>
      <th>sqft_basement</th>
      <th>yr_built</th>
      <th>yr_renovated</th>
      <th>zipcode</th>
      <th>lat</th>
      <th>long</th>
      <th>sqft_living15</th>
      <th>sqft_lot15</th>
      <th>yr_sales</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>7129300520</td>
      <td>20141013T000000</td>
      <td>221900</td>
      <td>3</td>
      <td>1.00</td>
      <td>1180</td>
      <td>5650</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>1180</td>
      <td>0</td>
      <td>1955</td>
      <td>0</td>
      <td>98178</td>
      <td>47.5112</td>
      <td>-122.257</td>
      <td>1340</td>
      <td>5650</td>
      <td>2014</td>
      <td>59</td>
    </tr>
    <tr>
      <td>1</td>
      <td>6414100192</td>
      <td>20141209T000000</td>
      <td>538000</td>
      <td>3</td>
      <td>2.25</td>
      <td>2570</td>
      <td>7242</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>2170</td>
      <td>400</td>
      <td>1951</td>
      <td>1991</td>
      <td>98125</td>
      <td>47.7210</td>
      <td>-122.319</td>
      <td>1690</td>
      <td>7639</td>
      <td>2014</td>
      <td>63</td>
    </tr>
    <tr>
      <td>2</td>
      <td>5631500400</td>
      <td>20150225T000000</td>
      <td>180000</td>
      <td>2</td>
      <td>1.00</td>
      <td>770</td>
      <td>10000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>6</td>
      <td>770</td>
      <td>0</td>
      <td>1933</td>
      <td>0</td>
      <td>98028</td>
      <td>47.7379</td>
      <td>-122.233</td>
      <td>2720</td>
      <td>8062</td>
      <td>2015</td>
      <td>82</td>
    </tr>
    <tr>
      <td>3</td>
      <td>2487200875</td>
      <td>20141209T000000</td>
      <td>604000</td>
      <td>4</td>
      <td>3.00</td>
      <td>1960</td>
      <td>5000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>7</td>
      <td>1050</td>
      <td>910</td>
      <td>1965</td>
      <td>0</td>
      <td>98136</td>
      <td>47.5208</td>
      <td>-122.393</td>
      <td>1360</td>
      <td>5000</td>
      <td>2014</td>
      <td>49</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1954400510</td>
      <td>20150218T000000</td>
      <td>510000</td>
      <td>3</td>
      <td>2.00</td>
      <td>1680</td>
      <td>8080</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>8</td>
      <td>1680</td>
      <td>0</td>
      <td>1987</td>
      <td>0</td>
      <td>98074</td>
      <td>47.6168</td>
      <td>-122.045</td>
      <td>1800</td>
      <td>7503</td>
      <td>2015</td>
      <td>28</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># I can see some negative numbers.</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;yr_sales&#39;</span><span class="p">,</span> <span class="s1">&#39;yr_built&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+--------+--------+---+
|        id|yr_sales|yr_built|age|
+----------+--------+--------+---+
|1832100030|    2014|    2015| -1|
|3076500830|    2014|    2015| -1|
|9520900210|    2014|    2015| -1|
|1250200495|    2014|    2015| -1|
|2770601530|    2014|    2015| -1|
+----------+--------+--------+---+
only showing top 5 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># some houses are sold before they are constructed.</span>
<span class="c1"># df.filter(df[&#39;age&#39;] == -1).toPandas()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>12</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Categorical-Features">Categorical Features<a class="anchor-link" href="#Categorical-Features"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;id&#39;, &#39;date&#39;, &#39;price&#39;, &#39;bedrooms&#39;, &#39;bathrooms&#39;, &#39;sqft_living&#39;, &#39;sqft_lot&#39;, &#39;floors&#39;, &#39;waterfront&#39;, &#39;view&#39;, &#39;condition&#39;, &#39;grade&#39;, &#39;sqft_above&#39;, &#39;sqft_basement&#39;, &#39;yr_built&#39;, &#39;yr_renovated&#39;, &#39;zipcode&#39;, &#39;lat&#39;, &#39;long&#39;, &#39;sqft_living15&#39;, &#39;sqft_lot15&#39;, &#39;yr_sales&#39;, &#39;age&#39;]
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cols_cat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bedrooms&#39;</span><span class="p">]</span> 

<span class="n">indexers</span> <span class="o">=</span> <span class="p">[</span><span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="n">column</span><span class="o">+</span><span class="s2">&quot;_index&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">cols_cat</span><span class="p">]</span>

<span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoderEstimator</span><span class="p">(</span>
    <span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="n">indexer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">()</span> <span class="k">for</span> <span class="n">indexer</span> <span class="ow">in</span> <span class="n">indexers</span><span class="p">],</span>
    <span class="n">outputCols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_encoded&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">indexer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">())</span> <span class="k">for</span> <span class="n">indexer</span> <span class="ow">in</span> <span class="n">indexers</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span>
    <span class="n">inputCols</span><span class="o">=</span><span class="n">encoder</span><span class="o">.</span><span class="n">getOutputCols</span><span class="p">(),</span>
    <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features_encoded_vec&quot;</span>
<span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="n">indexers</span> <span class="o">+</span> <span class="p">[</span><span class="n">encoder</span><span class="p">,</span> <span class="n">assembler</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>root
 |-- id: long (nullable = true)
 |-- date: string (nullable = true)
 |-- price: decimal(7,0) (nullable = true)
 |-- bedrooms: integer (nullable = true)
 |-- bathrooms: double (nullable = true)
 |-- sqft_living: integer (nullable = true)
 |-- sqft_lot: integer (nullable = true)
 |-- floors: double (nullable = true)
 |-- waterfront: integer (nullable = true)
 |-- view: integer (nullable = true)
 |-- condition: integer (nullable = true)
 |-- grade: integer (nullable = true)
 |-- sqft_above: integer (nullable = true)
 |-- sqft_basement: integer (nullable = true)
 |-- yr_built: integer (nullable = true)
 |-- yr_renovated: integer (nullable = true)
 |-- zipcode: integer (nullable = true)
 |-- lat: double (nullable = true)
 |-- long: double (nullable = true)
 |-- sqft_living15: integer (nullable = true)
 |-- sqft_lot15: integer (nullable = true)
 |-- yr_sales: integer (nullable = true)
 |-- age: integer (nullable = true)
 |-- bedrooms_index: double (nullable = false)
 |-- bedrooms_index_encoded: vector (nullable = true)
 |-- features_encoded_vec: vector (nullable = true)

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Boolean-Features">Boolean Features<a class="anchor-link" href="#Boolean-Features"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;basement_bool&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;sqft_basement&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">())</span> <span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;sqft_basement&#39;</span><span class="p">,</span><span class="s1">&#39;basement_bool&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+-------------+-------------+
|sqft_basement|basement_bool|
+-------------+-------------+
|            0|            0|
|          400|            1|
+-------------+-------------+
only showing top 2 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Bucketizing-Numerical-Features">Bucketizing Numerical Features<a class="anchor-link" href="#Bucketizing-Numerical-Features"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># sampling is discouraged in pyspark, we can check some top rows</span>
<span class="c1"># but this dataset is small and even pandas can handle this one.</span>

<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x118ad3e90&gt;</pre>
</div>

</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/d01_regression_modelling_using_pyspark_45_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+-------+------------------+
|summary|               age|
+-------+------------------+
|  count|             21613|
|   mean| 43.31781797991949|
| stddev|29.375492803877584|
|    min|                -1|
|    max|               115|
+-------+------------------+

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># there is no easy way to get max or min in pyspark</span>
<span class="n">age_min</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="s2">&quot;min&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">age_max</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 

<span class="n">age_min</span><span class="p">,</span> <span class="n">age_max</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(-1, 115)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">splits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">age_min</span><span class="p">,</span> <span class="n">age_max</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">splits</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([ -1.,  12.,  25.,  38.,  51.,  64.,  77.,  90., 103., 116.])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="k">import</span> <span class="n">Bucketizer</span>

<span class="n">bucketizer</span> <span class="o">=</span> <span class="n">Bucketizer</span><span class="p">(</span><span class="n">splits</span><span class="o">=</span><span class="n">splits</span><span class="p">,</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;age_cat&quot;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">bucketizer</span><span class="o">.</span><span class="n">setHandleInvalid</span><span class="p">(</span><span class="s2">&quot;keep&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span><span class="s1">&#39;age_cat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+---+-------+
|age|age_cat|
+---+-------+
| 59|    4.0|
| 63|    4.0|
| 82|    6.0|
| 49|    3.0|
| 28|    2.0|
+---+-------+
only showing top 5 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Dummy-Variables-for-Binned-and-Categorical-Features">Dummy Variables for Binned and Categorical Features<a class="anchor-link" href="#Dummy-Variables-for-Binned-and-Categorical-Features"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cols_cat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age_cat&#39;</span><span class="p">]</span> 

<span class="n">indexers</span> <span class="o">=</span> <span class="p">[</span><span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="n">column</span><span class="o">+</span><span class="s2">&quot;_index&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">cols_cat</span><span class="p">]</span>

<span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoderEstimator</span><span class="p">(</span>
    <span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="n">indexer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">()</span> <span class="k">for</span> <span class="n">indexer</span> <span class="ow">in</span> <span class="n">indexers</span><span class="p">],</span>
    <span class="n">outputCols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_encoded&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">indexer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">())</span> <span class="k">for</span> <span class="n">indexer</span> <span class="ow">in</span> <span class="n">indexers</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span>
    <span class="n">inputCols</span><span class="o">=</span><span class="n">encoder</span><span class="o">.</span><span class="n">getOutputCols</span><span class="p">(),</span>
    <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;age_cat_vec&quot;</span>
<span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="n">indexers</span> <span class="o">+</span> <span class="p">[</span><span class="n">encoder</span><span class="p">,</span> <span class="n">assembler</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>root
 |-- id: long (nullable = true)
 |-- date: string (nullable = true)
 |-- price: decimal(7,0) (nullable = true)
 |-- bedrooms: integer (nullable = true)
 |-- bathrooms: double (nullable = true)
 |-- sqft_living: integer (nullable = true)
 |-- sqft_lot: integer (nullable = true)
 |-- floors: double (nullable = true)
 |-- waterfront: integer (nullable = true)
 |-- view: integer (nullable = true)
 |-- condition: integer (nullable = true)
 |-- grade: integer (nullable = true)
 |-- sqft_above: integer (nullable = true)
 |-- sqft_basement: integer (nullable = true)
 |-- yr_built: integer (nullable = true)
 |-- yr_renovated: integer (nullable = true)
 |-- zipcode: integer (nullable = true)
 |-- lat: double (nullable = true)
 |-- long: double (nullable = true)
 |-- sqft_living15: integer (nullable = true)
 |-- sqft_lot15: integer (nullable = true)
 |-- yr_sales: integer (nullable = true)
 |-- age: integer (nullable = true)
 |-- bedrooms_index: double (nullable = false)
 |-- bedrooms_index_encoded: vector (nullable = true)
 |-- features_encoded_vec: vector (nullable = true)
 |-- basement_bool: integer (nullable = true)
 |-- age_cat: double (nullable = true)
 |-- age_cat_index: double (nullable = false)
 |-- age_cat_index_encoded: vector (nullable = true)
 |-- age_cat_vec: vector (nullable = true)

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span><span class="s1">&#39;age_cat&#39;</span><span class="p">,</span><span class="s1">&#39;age_cat_index&#39;</span><span class="p">,</span><span class="s1">&#39;age_cat_index_encoded&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+---+-------+-------------+---------------------+
|age|age_cat|age_cat_index|age_cat_index_encoded|
+---+-------+-------------+---------------------+
| 59|    4.0|          2.0|        (8,[2],[1.0])|
| 63|    4.0|          2.0|        (8,[2],[1.0])|
| 82|    6.0|          7.0|        (8,[7],[1.0])|
| 49|    3.0|          4.0|        (8,[4],[1.0])|
| 28|    2.0|          1.0|        (8,[1],[1.0])|
+---+-------+-------------+---------------------+
only showing top 5 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Log-Transform-Large-Numerical-Features">Log Transform Large Numerical Features<a class="anchor-link" href="#Log-Transform-Large-Numerical-Features"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;sqft_living&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;log1p_sqft_living&#39;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="s2">&quot;sqft_living&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+-----------+-----------------+
|sqft_living|log1p_sqft_living|
+-----------+-----------------+
|       1180|7.074116816197362|
|       2570|7.852050207265889|
+-----------+-----------------+
only showing top 2 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="mi">1180</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>7.074116816197362</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cols_log</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_living&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_lot&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_above&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sqft_basement&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_living15&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_lot15&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols_log</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;log1p_&#39;</span> <span class="o">+</span> <span class="n">c</span> <span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;id&#39;, &#39;date&#39;, &#39;price&#39;, &#39;bedrooms&#39;, &#39;bathrooms&#39;, &#39;sqft_living&#39;, &#39;sqft_lot&#39;, &#39;floors&#39;, &#39;waterfront&#39;, &#39;view&#39;, &#39;condition&#39;, &#39;grade&#39;, &#39;sqft_above&#39;, &#39;sqft_basement&#39;, &#39;yr_built&#39;, &#39;yr_renovated&#39;, &#39;zipcode&#39;, &#39;lat&#39;, &#39;long&#39;, &#39;sqft_living15&#39;, &#39;sqft_lot15&#39;, &#39;yr_sales&#39;, &#39;age&#39;, &#39;bedrooms_index&#39;, &#39;bedrooms_index_encoded&#39;, &#39;features_encoded_vec&#39;, &#39;basement_bool&#39;, &#39;age_cat&#39;, &#39;age_cat_index&#39;, &#39;age_cat_index_encoded&#39;, &#39;age_cat_vec&#39;, &#39;log1p_price&#39;, &#39;log1p_sqft_living&#39;, &#39;log1p_sqft_lot&#39;, &#39;log1p_sqft_above&#39;, &#39;log1p_sqft_basement&#39;, &#39;log1p_sqft_living15&#39;, &#39;log1p_sqft_lot15&#39;]
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s1">&#39;log1p_sqft_basement&#39;</span><span class="p">,</span> <span class="s1">&#39;log1p_sqft_living15&#39;</span><span class="p">,</span> <span class="s1">&#39;log1p_sqft_lot15&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+-------------------+-------------------+-----------------+
|log1p_sqft_basement|log1p_sqft_living15| log1p_sqft_lot15|
+-------------------+-------------------+-----------------+
|                0.0|  7.201170883281678|8.639587799629844|
|  5.993961427306569|   7.43307534889858|8.941152882160566|
+-------------------+-------------------+-----------------+
only showing top 2 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cols_after_log</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;log1p_&#39;</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols_log</span><span class="p">]</span>
<span class="n">cols_after_log</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;log1p_price&#39;,
 &#39;log1p_sqft_living&#39;,
 &#39;log1p_sqft_lot&#39;,
 &#39;log1p_sqft_above&#39;,
 &#39;log1p_sqft_basement&#39;,
 &#39;log1p_sqft_living15&#39;,
 &#39;log1p_sqft_lot15&#39;]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Combine-All-Features-to-One-Column">Combine All Features to One Column<a class="anchor-link" href="#Combine-All-Features-to-One-Column"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;id&#39;, &#39;date&#39;, &#39;price&#39;, &#39;bedrooms&#39;, &#39;bathrooms&#39;, &#39;sqft_living&#39;, &#39;sqft_lot&#39;, &#39;floors&#39;, &#39;waterfront&#39;, &#39;view&#39;, &#39;condition&#39;, &#39;grade&#39;, &#39;sqft_above&#39;, &#39;sqft_basement&#39;, &#39;yr_built&#39;, &#39;yr_renovated&#39;, &#39;zipcode&#39;, &#39;lat&#39;, &#39;long&#39;, &#39;sqft_living15&#39;, &#39;sqft_lot15&#39;, &#39;yr_sales&#39;, &#39;age&#39;, &#39;bedrooms_index&#39;, &#39;bedrooms_index_encoded&#39;, &#39;features_encoded_vec&#39;, &#39;basement_bool&#39;, &#39;age_cat&#39;, &#39;age_cat_index&#39;, &#39;age_cat_index_encoded&#39;, &#39;age_cat_vec&#39;, &#39;log1p_price&#39;, &#39;log1p_sqft_living&#39;, &#39;log1p_sqft_lot&#39;, &#39;log1p_sqft_above&#39;, &#39;log1p_sqft_basement&#39;, &#39;log1p_sqft_living15&#39;, &#39;log1p_sqft_lot15&#39;]
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">selected_features</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_living&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_lot&#39;</span><span class="p">,</span> <span class="s1">&#39;floors&#39;</span><span class="p">,</span> <span class="s1">&#39;waterfront&#39;</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="s1">&#39;grade&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_above&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_basement&#39;</span><span class="p">,</span> <span class="s1">&#39;yr_built&#39;</span><span class="p">,</span> <span class="s1">&#39;yr_renovated&#39;</span><span class="p">,</span> <span class="s1">&#39;zipcode&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;long&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_living15&#39;</span><span class="p">,</span> <span class="s1">&#39;sqft_lot15&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span>
    <span class="n">inputCols</span><span class="o">=</span> <span class="n">selected_features</span><span class="p">,</span>
    <span class="n">outputCol</span><span class="o">=</span><span class="s1">&#39;features&#39;</span>
<span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>root
 |-- id: long (nullable = true)
 |-- date: string (nullable = true)
 |-- price: decimal(7,0) (nullable = true)
 |-- bedrooms: integer (nullable = true)
 |-- bathrooms: double (nullable = true)
 |-- sqft_living: integer (nullable = true)
 |-- sqft_lot: integer (nullable = true)
 |-- floors: double (nullable = true)
 |-- waterfront: integer (nullable = true)
 |-- view: integer (nullable = true)
 |-- condition: integer (nullable = true)
 |-- grade: integer (nullable = true)
 |-- sqft_above: integer (nullable = true)
 |-- sqft_basement: integer (nullable = true)
 |-- yr_built: integer (nullable = true)
 |-- yr_renovated: integer (nullable = true)
 |-- zipcode: integer (nullable = true)
 |-- lat: double (nullable = true)
 |-- long: double (nullable = true)
 |-- sqft_living15: integer (nullable = true)
 |-- sqft_lot15: integer (nullable = true)
 |-- yr_sales: integer (nullable = true)
 |-- age: integer (nullable = true)
 |-- bedrooms_index: double (nullable = false)
 |-- bedrooms_index_encoded: vector (nullable = true)
 |-- features_encoded_vec: vector (nullable = true)
 |-- basement_bool: integer (nullable = true)
 |-- age_cat: double (nullable = true)
 |-- age_cat_index: double (nullable = false)
 |-- age_cat_index_encoded: vector (nullable = true)
 |-- age_cat_vec: vector (nullable = true)
 |-- log1p_price: double (nullable = true)
 |-- log1p_sqft_living: double (nullable = true)
 |-- log1p_sqft_lot: double (nullable = true)
 |-- log1p_sqft_above: double (nullable = true)
 |-- log1p_sqft_basement: double (nullable = true)
 |-- log1p_sqft_living15: double (nullable = true)
 |-- log1p_sqft_lot15: double (nullable = true)
 |-- features: vector (nullable = true)

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Feature-Scaling">Feature Scaling<a class="anchor-link" href="#Feature-Scaling"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="k">import</span> <span class="n">StandardScaler</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s1">&#39;features_scaled&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;features&quot;</span><span class="p">,</span><span class="s2">&quot;features_scaled&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>features</th>
      <th>features_scaled</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>[3.0, 1.0, 1180.0, 5650.0, 1.0, 0.0, 0.0, 3.0,...</td>
      <td>[3.2255919977909313, 1.2984261719459003, 1.284...</td>
    </tr>
    <tr>
      <td>1</td>
      <td>[3.0, 2.25, 2570.0, 7242.0, 2.0, 0.0, 0.0, 3.0...</td>
      <td>[3.2255919977909313, 2.9214588868782756, 2.798...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Train-Test-Splitting">Train Test Splitting<a class="anchor-link" href="#Train-Test-Splitting"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">],</span> <span class="n">seed</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="n">test</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(17323, 4290)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Modelling">Modelling<a class="anchor-link" href="#Modelling"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Linear-Regression">Linear Regression<a class="anchor-link" href="#Linear-Regression"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="k">import</span> <span class="n">LinearRegression</span>

<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">featuresCol</span><span class="o">=</span><span class="s1">&#39;features_scaled&#39;</span><span class="p">,</span>
                      <span class="n">labelCol</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">,</span>
                     <span class="n">predictionCol</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span>
                     <span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Model-Evaluation">Model Evaluation<a class="anchor-link" href="#Model-Evaluation"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_method_attributes</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>aggregationDepth</td>
      <td>explainParam</td>
      <td>getParam</td>
      <td>isSet</td>
      <td>params</td>
      <td>scale</td>
      <td>tol</td>
    </tr>
    <tr>
      <td>1</td>
      <td>coefficients</td>
      <td>explainParams</td>
      <td>hasDefault</td>
      <td>labelCol</td>
      <td>predictionCol</td>
      <td>set</td>
      <td>transform</td>
    </tr>
    <tr>
      <td>2</td>
      <td>copy</td>
      <td>extractParamMap</td>
      <td>hasParam</td>
      <td>load</td>
      <td>read</td>
      <td>solver</td>
      <td>uid</td>
    </tr>
    <tr>
      <td>3</td>
      <td>elasticNetParam</td>
      <td>featuresCol</td>
      <td>hasSummary</td>
      <td>loss</td>
      <td>regParam</td>
      <td>standardization</td>
      <td>weightCol</td>
    </tr>
    <tr>
      <td>4</td>
      <td>epsilon</td>
      <td>fitIntercept</td>
      <td>intercept</td>
      <td>maxIter</td>
      <td>save</td>
      <td>summary</td>
      <td>write</td>
    </tr>
    <tr>
      <td>5</td>
      <td>evaluate</td>
      <td>getOrDefault</td>
      <td>isDefined</td>
      <td>numFeatures</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">coefficients</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>DenseVector([-33265.0953, 31687.8075, 6008989.6808, 5326.5894, 3612.2834, 50436.1052, 40515.9324, 17170.2772, 112715.2636, -5267793.1233, -2829159.902, -76964.894, 7958.3034, -31162.3941, 83519.0309, -30240.0468, 14860.2427, -10447.7218])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">intercept</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>6690330.8435488995</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_coeff</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Feature&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Intercept&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">selected_features</span><span class="p">,</span>
  <span class="s2">&quot;Co-efficients&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">coefficients</span><span class="o">.</span><span class="n">toArray</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">intercept</span><span class="p">)})</span>


<span class="n">df_coeff</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feature</th>
      <th>Co-efficients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>Intercept</td>
      <td>6.690331e+06</td>
    </tr>
    <tr>
      <td>1</td>
      <td>bedrooms</td>
      <td>-3.326510e+04</td>
    </tr>
    <tr>
      <td>2</td>
      <td>bathrooms</td>
      <td>3.168781e+04</td>
    </tr>
    <tr>
      <td>3</td>
      <td>sqft_living</td>
      <td>6.008990e+06</td>
    </tr>
    <tr>
      <td>4</td>
      <td>sqft_lot</td>
      <td>5.326589e+03</td>
    </tr>
    <tr>
      <td>5</td>
      <td>floors</td>
      <td>3.612283e+03</td>
    </tr>
    <tr>
      <td>6</td>
      <td>waterfront</td>
      <td>5.043611e+04</td>
    </tr>
    <tr>
      <td>7</td>
      <td>view</td>
      <td>4.051593e+04</td>
    </tr>
    <tr>
      <td>8</td>
      <td>condition</td>
      <td>1.717028e+04</td>
    </tr>
    <tr>
      <td>9</td>
      <td>grade</td>
      <td>1.127153e+05</td>
    </tr>
    <tr>
      <td>10</td>
      <td>sqft_above</td>
      <td>-5.267793e+06</td>
    </tr>
    <tr>
      <td>11</td>
      <td>sqft_basement</td>
      <td>-2.829160e+06</td>
    </tr>
    <tr>
      <td>12</td>
      <td>yr_built</td>
      <td>-7.696489e+04</td>
    </tr>
    <tr>
      <td>13</td>
      <td>yr_renovated</td>
      <td>7.958303e+03</td>
    </tr>
    <tr>
      <td>14</td>
      <td>zipcode</td>
      <td>-3.116239e+04</td>
    </tr>
    <tr>
      <td>15</td>
      <td>lat</td>
      <td>8.351903e+04</td>
    </tr>
    <tr>
      <td>16</td>
      <td>long</td>
      <td>-3.024005e+04</td>
    </tr>
    <tr>
      <td>17</td>
      <td>sqft_living15</td>
      <td>1.486024e+04</td>
    </tr>
    <tr>
      <td>18</td>
      <td>sqft_lot15</td>
      <td>-1.044772e+04</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Model-Predictions">Model Predictions<a class="anchor-link" href="#Model-Predictions"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preds</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">preds</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+------------------+
| price|        prediction|
+------+------------------+
|235000|225548.18837336078|
|178000|293933.70595353097|
|487000| 639513.5238347957|
|281000|114608.27346567344|
|465000| 453320.0125229405|
+------+------------------+
only showing top 5 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preds_and_labels</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<span class="n">preds_and_labels</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+------------------+------+
|        prediction| price|
+------------------+------+
|225548.18837336078|235000|
|293933.70595353097|178000|
| 639513.5238347957|487000|
|114608.27346567344|281000|
| 453320.0125229405|465000|
+------------------+------+
only showing top 5 rows

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Model-Evaluation-Metrics">Model Evaluation Metrics<a class="anchor-link" href="#Model-Evaluation-Metrics"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_method_attributes</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>coefficientStandardErrors</td>
      <td>featuresCol</td>
      <td>numInstances</td>
      <td>predictions</td>
      <td>rootMeanSquaredError</td>
    </tr>
    <tr>
      <td>1</td>
      <td>degreesOfFreedom</td>
      <td>labelCol</td>
      <td>objectiveHistory</td>
      <td>r2</td>
      <td>tValues</td>
    </tr>
    <tr>
      <td>2</td>
      <td>devianceResiduals</td>
      <td>meanAbsoluteError</td>
      <td>pValues</td>
      <td>r2adj</td>
      <td>totalIterations</td>
    </tr>
    <tr>
      <td>3</td>
      <td>explainedVariance</td>
      <td>meanSquaredError</td>
      <td>predictionCol</td>
      <td>residuals</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;coefficientStandardErrors&#39;, &#39;degreesOfFreedom&#39;, &#39;devianceResiduals&#39;, &#39;explainedVariance&#39;, &#39;featuresCol&#39;, &#39;labelCol&#39;, &#39;meanAbsoluteError&#39;, &#39;meanSquaredError&#39;, &#39;numInstances&#39;, &#39;objectiveHistory&#39;, &#39;pValues&#39;, &#39;predictionCol&#39;, &#39;predictions&#39;, &#39;r2&#39;, &#39;r2adj&#39;, &#39;residuals&#39;, &#39;rootMeanSquaredError&#39;, &#39;tValues&#39;, &#39;totalIterations&#39;]
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;explainedVariance&#39;</span><span class="p">,</span> <span class="s1">&#39;meanAbsoluteError&#39;</span><span class="p">,</span>
           <span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="s1">&#39;r2adj&#39;</span><span class="p">,</span>  <span class="s1">&#39;rootMeanSquaredError&#39;</span><span class="p">]</span>

<span class="n">metrics_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">]</span>

<span class="n">df_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
                          <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">metrics_values</span><span class="p">})</span>

<span class="n">df_metrics</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>metric</th>
      <th>values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>explainedVariance</td>
      <td>9.430923e+10</td>
    </tr>
    <tr>
      <td>1</td>
      <td>meanAbsoluteError</td>
      <td>1.259226e+05</td>
    </tr>
    <tr>
      <td>2</td>
      <td>r2</td>
      <td>6.997472e-01</td>
    </tr>
    <tr>
      <td>3</td>
      <td>r2adj</td>
      <td>6.994969e-01</td>
    </tr>
    <tr>
      <td>4</td>
      <td>rootMeanSquaredError</td>
      <td>2.011639e+05</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Model-Evaluation-using-ml.evaluation">Model Evaluation using ml.evaluation<a class="anchor-link" href="#Model-Evaluation-using-ml.evaluation"> </a></h3><p><a href="https://spark.apache.org/docs/latest/api/python/_modules/pyspark/ml/evaluation.html">https://spark.apache.org/docs/latest/api/python/_modules/pyspark/ml/evaluation.html</a></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="k">import</span> <span class="n">RegressionEvaluator</span>


<span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span><span class="s1">&#39;mae&#39;</span><span class="p">,</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span>
<span class="n">metrics_values</span> <span class="o">=</span> <span class="p">[</span> <span class="n">RegressionEvaluator</span><span class="p">(</span><span class="n">predictionCol</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
                                <span class="n">labelCol</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">,</span>
                                <span class="n">metricName</span><span class="o">=</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds_and_labels</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span> <span class="p">]</span>

<span class="n">df_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
                          <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">metrics_values</span><span class="p">})</span>

<span class="n">df_metrics</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>metric</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>rmse</td>
      <td>193679.667761</td>
    </tr>
    <tr>
      <td>1</td>
      <td>mae</td>
      <td>124786.249732</td>
    </tr>
    <tr>
      <td>2</td>
      <td>r2</td>
      <td>0.717238</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Elastic-Net-Regression">Elastic Net Regression<a class="anchor-link" href="#Elastic-Net-Regression"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pred_col</span> <span class="o">=</span> <span class="s1">&#39;prediction_elasticnet&#39;</span>

<span class="n">model</span> <span class="o">=</span> <span class="p">(</span><span class="n">LinearRegression</span><span class="p">(</span><span class="n">featuresCol</span><span class="o">=</span><span class="s1">&#39;features_scaled&#39;</span><span class="p">,</span>
                       <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;price&quot;</span><span class="p">,</span>
                       <span class="n">predictionCol</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                       <span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                       <span class="n">regParam</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                       <span class="n">elasticNetParam</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                       <span class="n">standardization</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
     <span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">preds_and_labels</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">pred_col</span><span class="p">,</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>

<span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span><span class="s1">&#39;mae&#39;</span><span class="p">,</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span>

<span class="n">metrics_values</span> <span class="o">=</span> <span class="p">[</span> <span class="n">RegressionEvaluator</span><span class="p">(</span><span class="n">predictionCol</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                                <span class="n">labelCol</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">,</span>
                                <span class="n">metricName</span><span class="o">=</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds_and_labels</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span> <span class="p">]</span>

<span class="n">df_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
                          <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">metrics_values</span><span class="p">})</span>

<span class="n">df_metrics</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>metric</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>rmse</td>
      <td>193975.893391</td>
    </tr>
    <tr>
      <td>1</td>
      <td>mae</td>
      <td>125668.434025</td>
    </tr>
    <tr>
      <td>2</td>
      <td>r2</td>
      <td>0.716372</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Decision-Tree-Regressor">Decision Tree Regressor<a class="anchor-link" href="#Decision-Tree-Regressor"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="k">import</span> <span class="n">DecisionTreeRegressor</span>

<span class="n">pred_col</span> <span class="o">=</span> <span class="s1">&#39;prediction_dtree&#39;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">featuresCol</span><span class="o">=</span><span class="s1">&#39;features_scaled&#39;</span><span class="p">,</span>
                       <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;price&quot;</span><span class="p">,</span>
                       <span class="n">predictionCol</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                       <span class="n">seed</span><span class="o">=</span><span class="n">random_state</span>
                       <span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">preds_and_labels</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">pred_col</span><span class="p">,</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>

<span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span><span class="s1">&#39;mae&#39;</span><span class="p">,</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span>

<span class="n">metrics_values</span> <span class="o">=</span> <span class="p">[</span> <span class="n">RegressionEvaluator</span><span class="p">(</span><span class="n">predictionCol</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                                <span class="n">labelCol</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">,</span>
                                <span class="n">metricName</span><span class="o">=</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds_and_labels</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span> <span class="p">]</span>

<span class="n">df_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
                          <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">metrics_values</span><span class="p">})</span>

<span class="n">df_metrics</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>metric</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>rmse</td>
      <td>184587.818978</td>
    </tr>
    <tr>
      <td>1</td>
      <td>mae</td>
      <td>113562.302351</td>
    </tr>
    <tr>
      <td>2</td>
      <td>r2</td>
      <td>0.743162</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Random-Forest-Regressor">Random Forest Regressor<a class="anchor-link" href="#Random-Forest-Regressor"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="k">import</span> <span class="n">RandomForestRegressor</span>

<span class="n">pred_col</span> <span class="o">=</span> <span class="s1">&#39;prediction_rf&#39;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">featuresCol</span><span class="o">=</span><span class="s1">&#39;features_scaled&#39;</span><span class="p">,</span>
                       <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;price&quot;</span><span class="p">,</span>
                       <span class="n">predictionCol</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                       <span class="n">seed</span><span class="o">=</span><span class="n">random_state</span>
                       <span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">preds_rf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">preds_and_labels</span> <span class="o">=</span> <span class="n">preds_rf</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">pred_col</span><span class="p">,</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>

<span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span><span class="s1">&#39;mae&#39;</span><span class="p">,</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span>

<span class="n">metrics_values</span> <span class="o">=</span> <span class="p">[</span> <span class="n">RegressionEvaluator</span><span class="p">(</span><span class="n">predictionCol</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                                <span class="n">labelCol</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">,</span>
                                <span class="n">metricName</span><span class="o">=</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds_and_labels</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span> <span class="p">]</span>

<span class="n">df_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
                          <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">metrics_values</span><span class="p">})</span>

<span class="n">df_metrics</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>metric</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>rmse</td>
      <td>171490.447891</td>
    </tr>
    <tr>
      <td>1</td>
      <td>mae</td>
      <td>105460.153789</td>
    </tr>
    <tr>
      <td>2</td>
      <td>r2</td>
      <td>0.778316</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Parameter-Tuning">Parameter Tuning<a class="anchor-link" href="#Parameter-Tuning"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;id&#39;, &#39;date&#39;, &#39;price&#39;, &#39;bedrooms&#39;, &#39;bathrooms&#39;, &#39;sqft_living&#39;, &#39;sqft_lot&#39;, &#39;floors&#39;, &#39;waterfront&#39;, &#39;view&#39;, &#39;condition&#39;, &#39;grade&#39;, &#39;sqft_above&#39;, &#39;sqft_basement&#39;, &#39;yr_built&#39;, &#39;yr_renovated&#39;, &#39;zipcode&#39;, &#39;lat&#39;, &#39;long&#39;, &#39;sqft_living15&#39;, &#39;sqft_lot15&#39;, &#39;yr_sales&#39;, &#39;age&#39;, &#39;bedrooms_index&#39;, &#39;bedrooms_index_encoded&#39;, &#39;features_encoded_vec&#39;, &#39;basement_bool&#39;, &#39;age_cat&#39;, &#39;age_cat_index&#39;, &#39;age_cat_index_encoded&#39;, &#39;age_cat_vec&#39;, &#39;log1p_price&#39;, &#39;log1p_sqft_living&#39;, &#39;log1p_sqft_lot&#39;, &#39;log1p_sqft_above&#39;, &#39;log1p_sqft_basement&#39;, &#39;log1p_sqft_living15&#39;, &#39;log1p_sqft_lot15&#39;, &#39;features&#39;, &#39;features_scaled&#39;]
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="k">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.tuning</span> <span class="k">import</span> <span class="n">ParamGridBuilder</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.tuning</span> <span class="k">import</span> <span class="n">CrossValidator</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">model_rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">labelCol</span> <span class="o">=</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="n">numTrees</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

<span class="n">grid_depths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
<span class="n">paramGrid</span> <span class="o">=</span> <span class="n">ParamGridBuilder</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">addGrid</span><span class="p">(</span><span class="n">model_rf</span><span class="o">.</span><span class="n">maxDepth</span><span class="p">,</span> <span class="n">grid_depths</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">addGrid</span><span class="p">(</span><span class="n">model_rf</span><span class="o">.</span><span class="n">minInstancesPerNode</span><span class="p">,</span> <span class="n">grid_depths</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_rf</span><span class="p">])</span>

<span class="n">evaluator</span> <span class="o">=</span> <span class="n">RegressionEvaluator</span><span class="p">(</span><span class="n">labelCol</span> <span class="o">=</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span>
                                <span class="n">predictionCol</span> <span class="o">=</span> <span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
                                <span class="n">metricName</span> <span class="o">=</span> <span class="s2">&quot;r2&quot;</span><span class="p">)</span> 

<span class="n">crossval</span> <span class="o">=</span> <span class="n">CrossValidator</span><span class="p">(</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">,</span>
                          <span class="n">estimatorParamMaps</span> <span class="o">=</span> <span class="n">paramGrid</span><span class="p">,</span>
                          <span class="n">evaluator</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">,</span>
                          <span class="n">seed</span> <span class="o">=</span> <span class="n">random_state</span><span class="p">,</span>
                          <span class="n">parallelism</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="c1"># number of threads to use</span>
                          <span class="n">numFolds</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>


<span class="n">model_cv</span> <span class="o">=</span> <span class="n">crossval</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time taken: </span><span class="si">{:.0f}</span><span class="s1"> min </span><span class="si">{:.0f}</span><span class="s1"> secs&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">divmod</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="mi">60</span><span class="p">)))</span>
<span class="c1"># Time taken: 5 min 40 secs with parallelism 1  (5 folds, numtree = 50)</span>
<span class="c1"># 3min 22 sec with 10 threads</span>
<span class="c1"># 3min 18 sec with 50 threads</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Time taken: 3 min 41 secs
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_method_attributes</span><span class="p">(</span><span class="n">model_cv</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>avgMetrics</td>
      <td>evaluator</td>
      <td>getEstimatorParamMaps</td>
      <td>hasDefault</td>
      <td>params</td>
      <td>setEstimator</td>
      <td>subModels</td>
    </tr>
    <tr>
      <td>1</td>
      <td>bestModel</td>
      <td>explainParam</td>
      <td>getEvaluator</td>
      <td>hasParam</td>
      <td>read</td>
      <td>setEstimatorParamMaps</td>
      <td>transform</td>
    </tr>
    <tr>
      <td>2</td>
      <td>copy</td>
      <td>explainParams</td>
      <td>getOrDefault</td>
      <td>isDefined</td>
      <td>save</td>
      <td>setEvaluator</td>
      <td>uid</td>
    </tr>
    <tr>
      <td>3</td>
      <td>estimator</td>
      <td>extractParamMap</td>
      <td>getParam</td>
      <td>isSet</td>
      <td>seed</td>
      <td>setSeed</td>
      <td>write</td>
    </tr>
    <tr>
      <td>4</td>
      <td>estimatorParamMaps</td>
      <td>getEstimator</td>
      <td>getSeed</td>
      <td>load</td>
      <td>set</td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">prediction</span> <span class="o">=</span> <span class="n">model_cv</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;id&#39;, &#39;date&#39;, &#39;price&#39;, &#39;bedrooms&#39;, &#39;bathrooms&#39;, &#39;sqft_living&#39;, &#39;sqft_lot&#39;, &#39;floors&#39;, &#39;waterfront&#39;, &#39;view&#39;, &#39;condition&#39;, &#39;grade&#39;, &#39;sqft_above&#39;, &#39;sqft_basement&#39;, &#39;yr_built&#39;, &#39;yr_renovated&#39;, &#39;zipcode&#39;, &#39;lat&#39;, &#39;long&#39;, &#39;sqft_living15&#39;, &#39;sqft_lot15&#39;, &#39;yr_sales&#39;, &#39;age&#39;, &#39;bedrooms_index&#39;, &#39;bedrooms_index_encoded&#39;, &#39;features_encoded_vec&#39;, &#39;basement_bool&#39;, &#39;age_cat&#39;, &#39;age_cat_index&#39;, &#39;age_cat_index_encoded&#39;, &#39;age_cat_vec&#39;, &#39;log1p_price&#39;, &#39;log1p_sqft_living&#39;, &#39;log1p_sqft_lot&#39;, &#39;log1p_sqft_above&#39;, &#39;log1p_sqft_basement&#39;, &#39;log1p_sqft_living15&#39;, &#39;log1p_sqft_lot15&#39;, &#39;features&#39;, &#39;features_scaled&#39;, &#39;prediction&#39;]
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">model_cv</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">))</span> <span class="c1"># gives r2 for test data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.8720945704985017</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_cv</span><span class="o">.</span><span class="n">bestModel</span><span class="o">.</span><span class="n">stages</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[RandomForestRegressionModel (uid=RandomForestRegressor_4aa1dca99180) with 50 trees]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_cv</span><span class="o">.</span><span class="n">params</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Param(parent=&#39;CrossValidatorModel_c013b85a0a76&#39;, name=&#39;estimator&#39;, doc=&#39;estimator to be cross-validated&#39;),
 Param(parent=&#39;CrossValidatorModel_c013b85a0a76&#39;, name=&#39;estimatorParamMaps&#39;, doc=&#39;estimator param maps&#39;),
 Param(parent=&#39;CrossValidatorModel_c013b85a0a76&#39;, name=&#39;evaluator&#39;, doc=&#39;evaluator used to select hyper-parameters that maximize the validator metric&#39;),
 Param(parent=&#39;CrossValidatorModel_c013b85a0a76&#39;, name=&#39;seed&#39;, doc=&#39;random seed.&#39;)]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pred_col</span> <span class="o">=</span> <span class="s1">&#39;prediction&#39;</span>
<span class="n">preds_and_labels</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">pred_col</span><span class="p">,</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>

<span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span><span class="s1">&#39;mae&#39;</span><span class="p">,</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span>

<span class="n">metrics_values</span> <span class="o">=</span> <span class="p">[</span> <span class="n">RegressionEvaluator</span><span class="p">(</span><span class="n">predictionCol</span><span class="o">=</span><span class="n">pred_col</span><span class="p">,</span>
                                <span class="n">labelCol</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">,</span>
                                <span class="n">metricName</span><span class="o">=</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds_and_labels</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span> <span class="p">]</span>

<span class="n">df_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
                          <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">metrics_values</span><span class="p">})</span>

<span class="n">df_metrics</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>metric</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>rmse</td>
      <td>130261.997616</td>
    </tr>
    <tr>
      <td>1</td>
      <td>mae</td>
      <td>74422.817688</td>
    </tr>
    <tr>
      <td>2</td>
      <td>r2</td>
      <td>0.872095</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Feature-Importances">Feature Importances<a class="anchor-link" href="#Feature-Importances"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_cv</span><span class="o">.</span><span class="n">bestModel</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">featureImportances</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SparseVector(18, {0: 0.0038, 1: 0.0559, 2: 0.2632, 3: 0.0098, 4: 0.0025, 5: 0.0252, 6: 0.0269, 7: 0.0036, 8: 0.2335, 9: 0.0397, 10: 0.0133, 11: 0.0343, 12: 0.0022, 13: 0.0189, 14: 0.1467, 15: 0.0558, 16: 0.0534, 17: 0.0114})</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">prediction</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;ml_attr&quot;</span><span class="p">][</span><span class="s2">&quot;attrs&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;numeric&#39;: [{&#39;idx&#39;: 0, &#39;name&#39;: &#39;bedrooms&#39;},
  {&#39;idx&#39;: 1, &#39;name&#39;: &#39;bathrooms&#39;},
  {&#39;idx&#39;: 2, &#39;name&#39;: &#39;sqft_living&#39;},
  {&#39;idx&#39;: 3, &#39;name&#39;: &#39;sqft_lot&#39;},
  {&#39;idx&#39;: 4, &#39;name&#39;: &#39;floors&#39;},
  {&#39;idx&#39;: 5, &#39;name&#39;: &#39;waterfront&#39;},
  {&#39;idx&#39;: 6, &#39;name&#39;: &#39;view&#39;},
  {&#39;idx&#39;: 7, &#39;name&#39;: &#39;condition&#39;},
  {&#39;idx&#39;: 8, &#39;name&#39;: &#39;grade&#39;},
  {&#39;idx&#39;: 9, &#39;name&#39;: &#39;sqft_above&#39;},
  {&#39;idx&#39;: 10, &#39;name&#39;: &#39;sqft_basement&#39;},
  {&#39;idx&#39;: 11, &#39;name&#39;: &#39;yr_built&#39;},
  {&#39;idx&#39;: 12, &#39;name&#39;: &#39;yr_renovated&#39;},
  {&#39;idx&#39;: 13, &#39;name&#39;: &#39;zipcode&#39;},
  {&#39;idx&#39;: 14, &#39;name&#39;: &#39;lat&#39;},
  {&#39;idx&#39;: 15, &#39;name&#39;: &#39;long&#39;},
  {&#39;idx&#39;: 16, &#39;name&#39;: &#39;sqft_living15&#39;},
  {&#39;idx&#39;: 17, &#39;name&#39;: &#39;sqft_lot15&#39;}]}</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># https://stackoverflow.com/questions/42935914/how-to-map-features-from-the-output-of-a-vectorassembler-back-to-the-column-name</span>
<span class="k">def</span> <span class="nf">get_feature_importance_df</span><span class="p">(</span><span class="n">model_cv</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">featuresCol</span><span class="p">):</span>
    <span class="n">feat_imp</span> <span class="o">=</span> <span class="n">model_cv</span><span class="o">.</span><span class="n">bestModel</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">featureImportances</span>
    <span class="n">list_extract</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="n">featuresCol</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;ml_attr&quot;</span><span class="p">][</span><span class="s2">&quot;attrs&quot;</span><span class="p">]:</span>
        <span class="n">list_extract</span> <span class="o">+=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="n">featuresCol</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;ml_attr&quot;</span><span class="p">][</span><span class="s2">&quot;attrs&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        
    <span class="n">pandas_df_feat_imp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">list_extract</span><span class="p">)</span>
    <span class="n">pandas_df_feat_imp</span><span class="p">[</span><span class="s1">&#39;importance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas_df_feat_imp</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">feat_imp</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
    <span class="n">pandas_df_feat_imp</span> <span class="o">=</span> <span class="n">pandas_df_feat_imp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pandas_df_feat_imp</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pandas_df_feat_imp</span> <span class="o">=</span> <span class="n">get_feature_importance_df</span><span class="p">(</span><span class="n">model_cv</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">)</span>
<span class="n">pandas_df_feat_imp</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;importance&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style  type="text/css" >
    #T_9c12249c_f294_11e9_9603_acde48001122row0_col2 {
            background-color:  #023858;
            color:  #f1f1f1;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row1_col2 {
            background-color:  #045788;
            color:  #f1f1f1;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row2_col2 {
            background-color:  #5a9ec9;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row3_col2 {
            background-color:  #dad9ea;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row4_col2 {
            background-color:  #dad9ea;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row5_col2 {
            background-color:  #dcdaeb;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row6_col2 {
            background-color:  #e8e4f0;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row7_col2 {
            background-color:  #ede7f2;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row8_col2 {
            background-color:  #f1ebf4;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row9_col2 {
            background-color:  #f2ecf5;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row10_col2 {
            background-color:  #f5eff6;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row11_col2 {
            background-color:  #f9f2f8;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row12_col2 {
            background-color:  #faf3f9;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row13_col2 {
            background-color:  #fbf3f9;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row14_col2 {
            background-color:  #fef6fb;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row15_col2 {
            background-color:  #fef6fb;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row16_col2 {
            background-color:  #fff7fb;
            color:  #000000;
        }    #T_9c12249c_f294_11e9_9603_acde48001122row17_col2 {
            background-color:  #fff7fb;
            color:  #000000;
        }</style><table id="T_9c12249c_f294_11e9_9603_acde48001122" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >idx</th>        <th class="col_heading level0 col1" >name</th>        <th class="col_heading level0 col2" >importance</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row0" class="row_heading level0 row0" >2</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row0_col0" class="data row0 col0" >2</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row0_col1" class="data row0 col1" >sqft_living</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row0_col2" class="data row0 col2" >0.26316</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row1" class="row_heading level0 row1" >8</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row1_col0" class="data row1 col0" >8</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row1_col1" class="data row1 col1" >grade</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row1_col2" class="data row1 col2" >0.233472</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row2" class="row_heading level0 row2" >14</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row2_col0" class="data row2 col0" >14</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row2_col1" class="data row2 col1" >lat</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row2_col2" class="data row2 col2" >0.146669</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row3" class="row_heading level0 row3" >1</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row3_col0" class="data row3 col0" >1</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row3_col1" class="data row3 col1" >bathrooms</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row3_col2" class="data row3 col2" >0.0559069</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row4" class="row_heading level0 row4" >15</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row4_col0" class="data row4 col0" >15</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row4_col1" class="data row4 col1" >long</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row4_col2" class="data row4 col2" >0.0558219</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row5" class="row_heading level0 row5" >16</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row5_col0" class="data row5 col0" >16</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row5_col1" class="data row5 col1" >sqft_living15</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row5_col2" class="data row5 col2" >0.0533512</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row6" class="row_heading level0 row6" >9</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row6_col0" class="data row6 col0" >9</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row6_col1" class="data row6 col1" >sqft_above</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row6_col2" class="data row6 col2" >0.0396954</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row7" class="row_heading level0 row7" >11</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row7_col0" class="data row7 col0" >11</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row7_col1" class="data row7 col1" >yr_built</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row7_col2" class="data row7 col2" >0.0342701</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row8" class="row_heading level0 row8" >6</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row8_col0" class="data row8 col0" >6</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row8_col1" class="data row8 col1" >view</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row8_col2" class="data row8 col2" >0.0269099</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row9" class="row_heading level0 row9" >5</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row9_col0" class="data row9 col0" >5</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row9_col1" class="data row9 col1" >waterfront</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row9_col2" class="data row9 col2" >0.0251735</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row10" class="row_heading level0 row10" >13</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row10_col0" class="data row10 col0" >13</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row10_col1" class="data row10 col1" >zipcode</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row10_col2" class="data row10 col2" >0.0189028</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row11" class="row_heading level0 row11" >10</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row11_col0" class="data row11 col0" >10</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row11_col1" class="data row11 col1" >sqft_basement</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row11_col2" class="data row11 col2" >0.0133193</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row12" class="row_heading level0 row12" >17</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row12_col0" class="data row12 col0" >17</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row12_col1" class="data row12 col1" >sqft_lot15</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row12_col2" class="data row12 col2" >0.0113832</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row13" class="row_heading level0 row13" >3</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row13_col0" class="data row13 col0" >3</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row13_col1" class="data row13 col1" >sqft_lot</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row13_col2" class="data row13 col2" >0.00980678</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row14" class="row_heading level0 row14" >0</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row14_col0" class="data row14 col0" >0</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row14_col1" class="data row14 col1" >bedrooms</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row14_col2" class="data row14 col2" >0.00377609</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row15" class="row_heading level0 row15" >7</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row15_col0" class="data row15 col0" >7</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row15_col1" class="data row15 col1" >condition</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row15_col2" class="data row15 col2" >0.00362954</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row16" class="row_heading level0 row16" >4</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row16_col0" class="data row16 col0" >4</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row16_col1" class="data row16 col1" >floors</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row16_col2" class="data row16 col2" >0.00251064</td>
            </tr>
            <tr>
                        <th id="T_9c12249c_f294_11e9_9603_acde48001122level0_row17" class="row_heading level0 row17" >12</th>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row17_col0" class="data row17 col0" >12</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row17_col1" class="data row17 col1" >yr_renovated</td>
                        <td id="T_9c12249c_f294_11e9_9603_acde48001122row17_col2" class="data row17 col2" >0.00224113</td>
            </tr>
    </tbody></table>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

 


    </main>
    